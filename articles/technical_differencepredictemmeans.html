<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ggeffects">
<title>Technical Details: Difference between marginalization methods: the `margin` argument • ggeffects</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Technical Details: Difference between marginalization methods: the `margin` argument">
<meta property="og:description" content="ggeffects">
<meta property="og:image" content="https://strengejacke.github.io/ggeffects/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light" data-bs-theme="default"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ggeffects</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.1.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-introductions">Introductions</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-introductions">
    <a class="dropdown-item" href="../articles/ggeffects.html">Adjusted Predictions of Regression Models</a>
    <a class="dropdown-item" href="../articles/introduction_effectsatvalues.html">Adjusted Predictions at Specific Values</a>
    <a class="dropdown-item" href="../articles/introduction_randomeffects.html">Adjusted Predictions for Random Effects Models</a>
    <a class="dropdown-item" href="../articles/practical_robustestimation.html">(Cluster) Robust Standard Errors</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-interpretation">Interpretation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-interpretation">
    <a class="dropdown-item" href="../articles/introduction_comparisons_1.html">Contrasts and pairwise comparisons</a>
    <a class="dropdown-item" href="../articles/introduction_comparisons_2.html">Slopes, floodlight and spotlight analysis</a>
    <a class="dropdown-item" href="../articles/introduction_comparisons_3.html">Contrasts and pairwise comparisons for GLM</a>
    <a class="dropdown-item" href="../articles/introduction_partial_residuals.html">Adding Partial Residuals to Effects Plots</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-plotting-and-printing">Plotting and Printing</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-plotting-and-printing">
    <a class="dropdown-item" href="../articles/introduction_plotmethod.html">Plotting Adjusted Predictions</a>
    <a class="dropdown-item" href="../articles/introduction_plotcustomize.html">Customize Plot Appearance</a>
    <a class="dropdown-item" href="../articles/introduction_print.html">Customize Table Appearance</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-case-studies">Case Studies</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-case-studies">
    <a class="dropdown-item" href="../articles/practical_logisticmixedmodel.html">Logistic Mixed Effects Model with Interaction Term</a>
    <a class="dropdown-item" href="../articles/practical_intersectionality.html">Intersectionality analysis using the MAIHDA framework</a>
    <a class="dropdown-item" href="../articles/practical_marginaleffects_pkg.html">Comparison of ggeffects and marginaleffects</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-technical-details">Technical Details</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-technical-details">
    <a class="dropdown-item" href="../articles/technical_differencepredictemmeans.html">Difference between marginalization methods</a>
    <a class="dropdown-item" href="../articles/technical_stata.html">Different Output between Stata and ggeffects</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/strengejacke/ggeffects/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Technical Details: Difference between marginalization methods: the `margin` argument</h1>
                        <h4 data-toc-skip class="author">Daniel
Lüdecke</h4>
            
            <h4 data-toc-skip class="date">2024-04-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/strengejacke/ggeffects/blob/HEAD/vignettes/technical_differencepredictemmeans.Rmd" class="external-link"><code>vignettes/technical_differencepredictemmeans.Rmd</code></a></small>
      <div class="d-none name"><code>technical_differencepredictemmeans.Rmd</code></div>
    </div>

    
    
<p><code><a href="../reference/predict_response.html">predict_response()</a></code> computes marginal means or predicted
values for all possible levels or values from specified model’s
predictors (<em>focal terms</em>). These effects are “marginalized” (or
“averaged”) over the values or levels of remaining predictors (the
<strong>non-focal</strong> terms). The <code>margin</code> argument
specifies the method of marginalization. The following methods are
available:</p>
<ul>
<li><p><code>"mean_reference"</code>: non-focal predictors are set to
their mean (numeric variables), reference level (factors), or “most
common” value (mode) in case of character vectors. Technically, a data
grid is constructed, roughly comparable to <code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid()</a></code> on
all unique combinations of <code>model.frame(model)[, terms]</code>.
This data grid (see [<code><a href="../reference/new_data.html">data_grid()</a></code>]) is used for the
<code>newdata</code> argument of <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>. All remaining
covariates not specified in <code>terms</code> are held constant:
Numeric values are set to the mean, integer values are set to their
median, factors are set to their reference level and character vectors
to their mode (most common element).</p></li>
<li><p><code>"mean_mode"</code>: non-focal predictors are set to their
mean (numeric variables) or mode (factors, or “most common” value in
case of character vectors).</p></li>
<li><p><code>"marginalmeans"</code>: non-focal predictors are set to
their mean (numeric variables) or marginalized over the levels or
“values” for factors and character vectors. Marginalizing over the
factor levels of non-focal terms computes a kind of “weighted average”
for the values at which these terms are hold constant.</p></li>
<li><p><code>"empirical"</code> (or <code>"counterfactual"</code>):
non-focal predictors are marginalized over the observations in your
sample, for <em>counterfactual predictions</em>. Technically, predicted
values for each observation in the data are calculated multiple times
(the data is duplicated once for all unique values of the focal terms),
each time fixing one unique value or level of the focal terms and then
takes the average of these predicted values (aggregated/grouped by the
focal terms).</p></li>
</ul>
<p>That means:</p>
<ul>
<li><p>For models without categorical predictors, results are usually
identical, no matter which <code>margin</code> option is selected
(except some <em>slight</em> differences in the associated confidence
intervals, which are, however, negligible).</p></li>
<li><p>When all categorical predictors are specified in
<code>terms</code> and further (non-focal) terms are only numeric,
results are usually identical, as well.</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/ggeffects/">ggeffects</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">efc</span>, package <span class="op">=</span> <span class="st">"ggeffects"</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">barthtot</span> <span class="op">~</span> <span class="va">c12hour</span> <span class="op">+</span> <span class="va">neg_c_7</span>, data <span class="op">=</span> <span class="va">efc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we add margin = "mean_reference" to show that it is the default</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"mean_reference"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     75.07 | 72.96, 77.19</span></span>
<span><span class="co">#&gt;      20 |     70.15 | 68.40, 71.91</span></span>
<span><span class="co">#&gt;      45 |     64.01 | 62.40, 65.61</span></span>
<span><span class="co">#&gt;      65 |     59.09 | 57.32, 60.86</span></span>
<span><span class="co">#&gt;      85 |     54.17 | 52.04, 56.31</span></span>
<span><span class="co">#&gt;     105 |     49.25 | 46.64, 51.87</span></span>
<span><span class="co">#&gt;     125 |     44.34 | 41.18, 47.49</span></span>
<span><span class="co">#&gt;     170 |     33.27 | 28.78, 37.76</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 = 11.83</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     75.07 | 72.96, 77.19</span></span>
<span><span class="co">#&gt;      20 |     70.15 | 68.40, 71.91</span></span>
<span><span class="co">#&gt;      45 |     64.01 | 62.40, 65.61</span></span>
<span><span class="co">#&gt;      65 |     59.09 | 57.32, 60.86</span></span>
<span><span class="co">#&gt;      85 |     54.17 | 52.04, 56.31</span></span>
<span><span class="co">#&gt;     105 |     49.25 | 46.64, 51.87</span></span>
<span><span class="co">#&gt;     125 |     44.34 | 41.18, 47.49</span></span>
<span><span class="co">#&gt;     170 |     33.27 | 28.78, 37.76</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 = 11.83</span></span></code></pre></div>
<p>As can be seen, the continuous predictor <code>neg_c_7</code> is held
constant at its mean value, 11.83. For categorical predictors,
<code>margin = "mean_reference"</code> (the default, and thus not
specified in the above example) and
<code>margin = "marginalmeans"</code> behave differently. While
<code>"mean_reference"</code> uses the reference level of each
categorical predictor to hold it constant, <code>"marginalmeans"</code>
averages over the proportions of the categories of factors.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/datawizard/" class="external-link">datawizard</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">efc</span>, package <span class="op">=</span> <span class="st">"ggeffects"</span><span class="op">)</span></span>
<span><span class="va">efc</span><span class="op">$</span><span class="va">e42dep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://easystats.github.io/datawizard/reference/to_factor.html" class="external-link">to_factor</a></span><span class="op">(</span><span class="va">efc</span><span class="op">$</span><span class="va">e42dep</span><span class="op">)</span></span>
<span><span class="co"># we add categorical predictors to our model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">barthtot</span> <span class="op">~</span> <span class="va">c12hour</span> <span class="op">+</span> <span class="va">neg_c_7</span> <span class="op">+</span> <span class="va">e42dep</span>, data <span class="op">=</span> <span class="va">efc</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"mean_reference"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     92.74 | 88.48, 97.01</span></span>
<span><span class="co">#&gt;      20 |     91.32 | 87.06, 95.57</span></span>
<span><span class="co">#&gt;      45 |     89.53 | 85.20, 93.87</span></span>
<span><span class="co">#&gt;      65 |     88.10 | 83.64, 92.57</span></span>
<span><span class="co">#&gt;      85 |     86.68 | 82.03, 91.32</span></span>
<span><span class="co">#&gt;     105 |     85.25 | 80.37, 90.13</span></span>
<span><span class="co">#&gt;     125 |     83.82 | 78.67, 88.98</span></span>
<span><span class="co">#&gt;     170 |     80.61 | 74.71, 86.51</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 =       11.83</span></span>
<span><span class="co">#&gt; *  e42dep = independent</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     73.51 | 71.85, 75.18</span></span>
<span><span class="co">#&gt;      20 |     72.09 | 70.65, 73.53</span></span>
<span><span class="co">#&gt;      45 |     70.30 | 68.89, 71.71</span></span>
<span><span class="co">#&gt;      65 |     68.87 | 67.29, 70.46</span></span>
<span><span class="co">#&gt;      85 |     67.45 | 65.55, 69.34</span></span>
<span><span class="co">#&gt;     105 |     66.02 | 63.74, 68.30</span></span>
<span><span class="co">#&gt;     125 |     64.59 | 61.88, 67.31</span></span>
<span><span class="co">#&gt;     170 |     61.38 | 57.61, 65.15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 = 11.83</span></span></code></pre></div>
<p>In this case, one would obtain the same results for
<code>"mean_reference"</code> and <code>"marginalmeans"</code> again, if
<code>condition</code> is used to define specific levels at which
variables, in our case the factor <code>e42dep</code>, should be held
constant.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"mean_reference"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     92.74 | 88.48, 97.01</span></span>
<span><span class="co">#&gt;      20 |     91.32 | 87.06, 95.57</span></span>
<span><span class="co">#&gt;      45 |     89.53 | 85.20, 93.87</span></span>
<span><span class="co">#&gt;      65 |     88.10 | 83.64, 92.57</span></span>
<span><span class="co">#&gt;      85 |     86.68 | 82.03, 91.32</span></span>
<span><span class="co">#&gt;     105 |     85.25 | 80.37, 90.13</span></span>
<span><span class="co">#&gt;     125 |     83.82 | 78.67, 88.98</span></span>
<span><span class="co">#&gt;     170 |     80.61 | 74.71, 86.51</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 =       11.83</span></span>
<span><span class="co">#&gt; *  e42dep = independent</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span></span>
<span>  <span class="va">fit</span>,</span>
<span>  <span class="st">"c12hour"</span>,</span>
<span>  margin <span class="op">=</span> <span class="st">"marginalmeans"</span>,</span>
<span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>e42dep <span class="op">=</span> <span class="st">"independent"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     92.74 | 88.48, 97.01</span></span>
<span><span class="co">#&gt;      20 |     91.32 | 87.06, 95.57</span></span>
<span><span class="co">#&gt;      45 |     89.53 | 85.20, 93.87</span></span>
<span><span class="co">#&gt;      65 |     88.10 | 83.64, 92.57</span></span>
<span><span class="co">#&gt;      85 |     86.68 | 82.03, 91.32</span></span>
<span><span class="co">#&gt;     105 |     85.25 | 80.37, 90.13</span></span>
<span><span class="co">#&gt;     125 |     83.82 | 78.67, 88.98</span></span>
<span><span class="co">#&gt;     170 |     80.61 | 74.71, 86.51</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 = 11.83</span></span></code></pre></div>
<p>Another option is to use
<code>predict_response(margin = "empirical")</code> to compute
“counterfactual” adjusted predictions. This function is a wrapper for
the <code><a href="https://rdrr.io/pkg/marginaleffects/man/predictions.html" class="external-link">avg_predictions()</a></code>-method from the
<strong>marginaleffects</strong>-package. The major difference to
<code>margin = "marginalmeans"</code> is that estimated marginal means,
as computed by <code>"marginalmeans"</code>, are a special case of
predictions, made on a perfectly balanced grid of categorical
predictors, with numeric predictors held at their means, and
marginalized with respect to some focal variables.
<code>predict_response(margin = "empirical")</code>, in turn, calculates
predicted values for each observation in the data multiple times, each
time fixing the unique values or levels of the focal terms to one
specific value and then takes the average of these predicted values
(aggregated/grouped by the focal terms) - or in other words: the whole
dataset is duplicated once for every unique value of the focal terms,
makes predictions for each observation of the new dataset and take the
average of all predictions (grouped by focal terms). This is also called
“counterfactual” predictions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Average predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     67.73 | 66.15, 69.31</span></span>
<span><span class="co">#&gt;      20 |     66.30 | 65.03, 67.57</span></span>
<span><span class="co">#&gt;      45 |     64.52 | 63.38, 65.66</span></span>
<span><span class="co">#&gt;      65 |     63.09 | 61.81, 64.37</span></span>
<span><span class="co">#&gt;      85 |     61.66 | 60.07, 63.25</span></span>
<span><span class="co">#&gt;     105 |     60.23 | 58.24, 62.23</span></span>
<span><span class="co">#&gt;     125 |     58.81 | 56.37, 61.25</span></span>
<span><span class="co">#&gt;     170 |     55.59 | 52.08, 59.11</span></span></code></pre></div>
<p>To explain how <code>margin = "empirical"</code> works, let’s look at
following example. The confidence intervals for the simple means differ
from those of <code><a href="../reference/predict_response.html">predict_response()</a></code>, however, the predicted
and mean values are identical.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># create an unequal distributed factor, used as focal term</span></span>
<span><span class="va">iris</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">+</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># average predicted values</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"x"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Average predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; x | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; --------------------------</span></span>
<span><span class="co">#&gt; 1 |      3.12 | 2.94, 3.31</span></span>
<span><span class="co">#&gt; 2 |      3.11 | 2.99, 3.23</span></span>
<span><span class="co">#&gt; 3 |      2.97 | 2.87, 3.06</span></span>
<span><span class="co">#&gt; 4 |      3.09 | 3.00, 3.17</span></span>
<span></span>
<span><span class="co"># replicate the dataset for each level of "x", i.e. 4 times</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">4</span>, <span class="va">iris</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># for each data set, we set our focal term "x" to one of the four unique values</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, each <span class="op">=</span> <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># we calculate predicted values for each "dataset", i.e. we predict our outcome</span></span>
<span><span class="co"># for observations, for all levels of "x"</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="co"># now we compute the average predicted values for each level of "x"</span></span>
<span><span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/means_by_group.html" class="external-link">means_by_group</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"predicted"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Mean of predicted by x</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Category | Mean |   N |   SD |       95% CI |      p</span></span>
<span><span class="co">#&gt; ----------------------------------------------------</span></span>
<span><span class="co">#&gt; 1        | 3.12 | 150 | 0.28 | [3.08, 3.17] | 0.017 </span></span>
<span><span class="co">#&gt; 2        | 3.11 | 150 | 0.28 | [3.07, 3.16] | 0.059 </span></span>
<span><span class="co">#&gt; 3        | 2.97 | 150 | 0.28 | [2.92, 3.01] | &lt; .001</span></span>
<span><span class="co">#&gt; 4        | 3.09 | 150 | 0.28 | [3.04, 3.13] | 0.468 </span></span>
<span><span class="co">#&gt; Total    | 3.07 | 600 | 0.28 |              |       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Anova: R2=0.048; adj.R2=0.044; F=10.094; p&lt;.001</span></span></code></pre></div>
<p><strong>But when should I use which <code>margin</code>
option?</strong></p>
<p>When you are interested in the strength of association, it usually
doesn’t matter. as you can see in the plots below. The slope of our
focal term, <code>c12hour</code>, is the same for all four plots:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/see/" class="external-link">see</a></span><span class="op">)</span></span>
<span><span class="va">predicted_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span><span class="op">)</span></span>
<span><span class="va">predicted_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span><span class="op">)</span></span>
<span><span class="va">predicted_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>e42dep <span class="op">=</span> <span class="st">"independent"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">predicted_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predicted_1</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span>, show_title <span class="op">=</span> <span class="cn">FALSE</span>, show_x_title <span class="op">=</span> <span class="cn">FALSE</span>, show_y_title <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predicted_2</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span>, show_title <span class="op">=</span> <span class="cn">FALSE</span>, show_x_title <span class="op">=</span> <span class="cn">FALSE</span>, show_y_title <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predicted_3</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span>, show_title <span class="op">=</span> <span class="cn">FALSE</span>, show_x_title <span class="op">=</span> <span class="cn">FALSE</span>, show_y_title <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predicted_4</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span>, show_title <span class="op">=</span> <span class="cn">FALSE</span>, show_x_title <span class="op">=</span> <span class="cn">FALSE</span>, show_y_title <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://easystats.github.io/see/reference/plots.html" class="external-link">plots</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, n_rows <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="technical_differencepredictemmeans_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>However, the predicted outcome varies. This gives an impression when
<code>margin = "marginalmeans"</code>, i.e. <em>marginal</em> effects,
matter: when you want to predict your outcome, marginalized over the
different levels of factors, i.e. “generalized” to the population (of
your sample) on a <em>balanced grid</em> of focal terms.
<code>margin = "mean_reference"</code> would give a predicted outcome
for a <em>subgroup</em> (or: specific group) of your sample,
i.e. conditioned on specific levels of factors. Hence, the predicted
outcome does not necessarily generalize to the “population” (always
keeping in mind that we assume having a “representative sample” of a
“population” as data in our model). Finally,
<code>margin = "empirical"</code> gives you predictions averaged across
your sample and aggregated by the focal terms, and probably reflects
your data most realistically.</p>
<p><strong>What is the most apparent difference from
<code>margin = "empirical"</code> to the other options?</strong></p>
<p>The most apparent difference from <code>margin = "empirical"</code>
compared to the other methods occurs when you have categorical
co-variates (<em>non-focal terms</em>) with unequally distributed
levels. <code>margin = "marginalmeans"</code> will “average” over the
levels of non-focal factors, while <code>margin = "empirical"</code>
will average over the observations in your sample.</p>
<p>Let’s show this with a very simple example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># create an unequal distributed factor, used as non-focal term</span></span>
<span><span class="va">iris</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">+</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># predicted values, conditioned on x = 1</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Species    | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; -----------------------------------</span></span>
<span><span class="co">#&gt; setosa     |      3.50 | 3.30, 3.69</span></span>
<span><span class="co">#&gt; versicolor |      2.84 | 2.63, 3.04</span></span>
<span><span class="co">#&gt; virginica  |      3.04 | 2.85, 3.23</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * x = 1</span></span>
<span></span>
<span><span class="co"># predicted values, conditioned on weighted average of x</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Species    | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; -----------------------------------</span></span>
<span><span class="co">#&gt; setosa     |      3.45 | 3.35, 3.54</span></span>
<span><span class="co">#&gt; versicolor |      2.78 | 2.68, 2.89</span></span>
<span><span class="co">#&gt; virginica  |      2.99 | 2.89, 3.09</span></span>
<span></span>
<span><span class="co"># average predicted values, averaged over the sample and aggregated by "Species"</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Average predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Species    | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; -----------------------------------</span></span>
<span><span class="co">#&gt; setosa     |      3.43 | 3.34, 3.52</span></span>
<span><span class="co">#&gt; versicolor |      2.77 | 2.67, 2.86</span></span>
<span><span class="co">#&gt; virginica  |      2.97 | 2.88, 3.07</span></span></code></pre></div>
<p>There is no rule of thumb which approach is better; it depends on the
characteristics of the sample and the population to which should be
generalized. Consulting the <a href="https://marginaleffects.com/" class="external-link">marginaleffects-website</a> might
help to decide which approach is more appropriate.</p>
<p><strong>Showing the difference between <code>"marginalmeans"</code>
and <code>"empirical"</code></strong></p>
<p>A code example, where we compute the average predicted values the
estimated marginal means manually, shows the differences between these
two ways of averaging in detail.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">iris</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">+</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># average predicted values</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Average predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Species    | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; -----------------------------------</span></span>
<span><span class="co">#&gt; setosa     |      3.43 | 3.34, 3.52</span></span>
<span><span class="co">#&gt; versicolor |      2.77 | 2.67, 2.86</span></span>
<span><span class="co">#&gt; virginica  |      2.97 | 2.88, 3.07</span></span>
<span></span>
<span><span class="co"># replicate the dataset for each level of "Species", i.e. 3 times</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">iris</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># for each data set, we set our focal term to one of the three levels</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">Species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># we calculate predicted values for each "dataset", i.e. we predict our outcome</span></span>
<span><span class="co"># for observations, for all levels of "Species"</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="co"># now we compute the average predicted values by levels of "Species"</span></span>
<span><span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/means_by_group.html" class="external-link">means_by_group</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"predicted"</span>, <span class="st">"Species"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Mean of predicted by Species</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Category   | Mean |   N |   SD |       95% CI |      p</span></span>
<span><span class="co">#&gt; ------------------------------------------------------</span></span>
<span><span class="co">#&gt; setosa     | 3.43 | 150 | 0.06 | [3.42, 3.44] | &lt; .001</span></span>
<span><span class="co">#&gt; versicolor | 2.77 | 150 | 0.06 | [2.76, 2.78] | &lt; .001</span></span>
<span><span class="co">#&gt; virginica  | 2.97 | 150 | 0.06 | [2.96, 2.98] | &lt; .001</span></span>
<span><span class="co">#&gt; Total      | 3.06 | 450 | 0.28 |              |       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Anova: R2=0.951; adj.R2=0.951; F=4320.998; p&lt;.001</span></span>
<span></span>
<span><span class="co"># estimated marginal means, in turn, differ from the above, because they are</span></span>
<span><span class="co"># averaged across balanced reference grids for all focal terms, thereby non-focal</span></span>
<span><span class="co"># are hold constant at a "weighted average".</span></span>
<span></span>
<span><span class="co"># estimated marginal means, from `ggemmeans()`</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Species    | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; -----------------------------------</span></span>
<span><span class="co">#&gt; setosa     |      3.45 | 3.35, 3.54</span></span>
<span><span class="co">#&gt; versicolor |      2.78 | 2.68, 2.89</span></span>
<span><span class="co">#&gt; virginica  |      2.99 | 2.89, 3.09</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/new_data.html">data_grid</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/new_data.html">data_grid</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/new_data.html">data_grid</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"3"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/new_data.html">data_grid</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"4"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="co"># means calculated manually</span></span>
<span><span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/means_by_group.html" class="external-link">means_by_group</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"predicted"</span>, <span class="st">"Species"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Mean of predicted by Species</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Category   | Mean |  N |   SD |       95% CI |      p</span></span>
<span><span class="co">#&gt; -----------------------------------------------------</span></span>
<span><span class="co">#&gt; setosa     | 3.45 |  4 | 0.07 | [3.36, 3.53] | &lt; .001</span></span>
<span><span class="co">#&gt; versicolor | 2.78 |  4 | 0.07 | [2.70, 2.87] | &lt; .001</span></span>
<span><span class="co">#&gt; virginica  | 2.99 |  4 | 0.07 | [2.91, 3.07] | 0.019 </span></span>
<span><span class="co">#&gt; Total      | 3.07 | 12 | 0.30 |              |       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Anova: R2=0.952; adj.R2=0.941; F=88.566; p&lt;.001</span></span></code></pre></div>
<p><strong>When should I use which <code>margin</code>
option?</strong></p>
<p>The <em>strength</em> of the association should not be affected by
the way of averaging. You can see this when comparing the differences
between the predicted values, which are the same. If you’re interested
in differences between specific levels (or values) of your predictors,
it shouldn’t matter which function you use.</p>
<p>What <em>is</em> different is the predicted outcome, and therefore
the conclusions you would draw from the results.
<code>margin = "mean_reference"</code> or
<code>margin = "mean_mode"</code> predict your outcome for certain
characteristics of your sample (for “subgroups”, if you like).
<code>margin = "empirical"</code> and
<code>margin = "marginalmeans"</code> predict your outcome for an
“average observation” of your sample, with slightly different approaches
of averaging.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check that the difference between the predicted value, average predicted values</span></span>
<span><span class="co">#  estimated marginal means is the same</span></span>
<span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span><span class="op">)</span></span>
<span><span class="va">out3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"mean_reference"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">out1</span><span class="op">$</span><span class="va">predicted</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">out2</span><span class="op">$</span><span class="va">predicted</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">out1</span><span class="op">$</span><span class="va">predicted</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">predicted</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Some models are not yet supported by the <strong>emmeans</strong>
package, thus, for certain models, only <code>"mean_reference"</code>
works, not <code>"marginalmeans"</code>. <code>"empirical"</code> should
support the same (or more) models as <code>"mean_reference"</code>, but
averages predictions from the sample, and thus may not be the quantity
of interest. Sometimes, robust variance-covariance estimation is
required for confidence intervals of predictions. In such cases, you
have to rely on <code>"mean_reference"</code> or
<code>"empirical"</code>. If you have no categorical predictors as
non-focal terms (i.e. no factor needs to be held constant), then - as
shown above - <code>"mean_reference"</code> and
<code>"marginalmeans"</code> yield the same results.</p>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/strengejacke" class="external-link">Daniel Lüdecke</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
