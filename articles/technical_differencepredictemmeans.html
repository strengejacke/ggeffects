<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Technical Details: Difference Between Marginalization Methods: The `margin` Argument • ggeffects</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Technical Details: Difference Between Marginalization Methods: The `margin` Argument">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggeffects</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.19</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-introductions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Introductions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-introductions">
<li><a class="dropdown-item" href="../articles/ggeffects.html">Adjusted predictions of regression models</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_effectsatvalues.html">Adjusted predictions at specific values</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_randomeffects.html">Adjusted predictions for mixed models</a></li>
    <li><a class="dropdown-item" href="../articles/practical_robustestimation.html">(Cluster) Robust standard errors</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-interpretation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Interpretation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-interpretation">
<li><a class="dropdown-item" href="../articles/introduction_comparisons_1.html">Contrasts and pairwise comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_2.html">Slopes, floodlight and spotlight analysis</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_3.html">Contrasts and pairwise comparisons for GLM</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_4.html">Contrasts and pairwise comparisons for Zero-Inflation Models</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_5.html">Using marginaleffects or emmeans for comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_partial_residuals.html">Adding partial residuals to effects plots</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-plotting-and-printing" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Plotting and Printing</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-plotting-and-printing">
<li><a class="dropdown-item" href="../articles/introduction_plotmethod.html">Plotting adjusted predictions</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_plotcustomize.html">Customize plot appearance</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_print.html">Customize table appearance</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case Studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies">
<li><a class="dropdown-item" href="../articles/practical_glm_workflow.html">Simple workflow using logistic regression</a></li>
    <li><a class="dropdown-item" href="../articles/practical_logisticmixedmodel.html">Logistic mixed effects Model with interaction term</a></li>
    <li><a class="dropdown-item" href="../articles/practical_intersectionality.html">Intersectionality analysis using the MAIHDA framework</a></li>
    <li><a class="dropdown-item" href="../articles/practical_marginaleffects_pkg.html">Comparison of ggeffects and marginaleffects</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical-details" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical Details</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical-details">
<li><a class="dropdown-item" href="../articles/technical_get_predictions.html">Adding own class-methods to ggeffects</a></li>
    <li><a class="dropdown-item" href="../articles/technical_differencepredictemmeans.html">Difference between marginalization methods</a></li>
    <li><a class="dropdown-item" href="../articles/technical_stata.html">Different Output between Stata and ggeffects</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/strengejacke/ggeffects/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Technical Details: Difference Between Marginalization Methods: The `margin` Argument</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/strengejacke/ggeffects/blob/master/vignettes/technical_differencepredictemmeans.Rmd" class="external-link"><code>vignettes/technical_differencepredictemmeans.Rmd</code></a></small>
      <div class="d-none name"><code>technical_differencepredictemmeans.Rmd</code></div>
    </div>

    
    
<p><code><a href="../reference/predict_response.html">predict_response()</a></code> computes marginal means or predicted
values for all possible levels or values from specified model’s
predictors (<em>focal terms</em>). These effects are “marginalized” (or
“averaged”) over the values or levels of remaining predictors (the
<strong>non-focal</strong> terms). The <code>margin</code> argument
specifies the method of marginalization. The following methods are
available:</p>
<ul>
<li><p><code>"mean_reference"</code>: non-focal predictors are set to
their mean (numeric variables), reference level (factors), or “most
common” value (mode) in case of character vectors. Technically, a data
grid is constructed, roughly comparable to <code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid()</a></code> on
all unique combinations of <code>model.frame(model)[, terms]</code>.
This data grid (see <code><a href="../reference/new_data.html">data_grid()</a></code>) is used for the
<code>newdata</code> argument of <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>. All remaining
covariates not specified in <code>terms</code> are held constant:
Numeric values are set to the mean, integer values are set to their
median, factors are set to their reference level and character vectors
to their mode (most common element).</p></li>
<li><p><code>"mean_mode"</code>: non-focal predictors are set to their
mean (numeric variables) or mode (factors, or “most common” value in
case of character vectors).</p></li>
<li><p><code>"marginalmeans"</code>: non-focal predictors are set to
their mean (numeric variables) or marginalized over the levels or
“values” for factors and character vectors. Marginalizing over the
factor levels of non-focal terms computes a kind of “weighted average”
for the values at which these terms are hold constant.</p></li>
<li><p><code>"empirical"</code> (or <code>"counterfactual"</code>):
non-focal predictors are marginalized over the observations in your
sample, for <em>counterfactual predictions</em>. Technically, predicted
values for each observation in the data are calculated multiple times
(the data is duplicated once for all unique values of the focal terms),
each time fixing one unique value or level of the focal terms and then
takes the average of these predicted values (aggregated/grouped by the
focal terms).</p></li>
</ul>
<p>That means:</p>
<ul>
<li><p>For models without categorical predictors, results are usually
identical, no matter which <code>margin</code> option is selected
(except some <em>slight</em> differences in the associated confidence
intervals, which are, however, negligible).</p></li>
<li><p>When all categorical predictors are specified in
<code>terms</code> and further (non-focal) terms are only numeric,
results are usually identical, as well.</p></li>
</ul>
<p>In the <a href="ggeffects.html">general introduction</a>, the
<code>margin</code> argument is discussed more in detail, providing
hints on when to use which method. Here, we will provide a more
technical explanation of the differences between the methods.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/ggeffects/">ggeffects</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">efc</span>, package <span class="op">=</span> <span class="st">"ggeffects"</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">barthtot</span> <span class="op">~</span> <span class="va">c12hour</span> <span class="op">+</span> <span class="va">neg_c_7</span>, data <span class="op">=</span> <span class="va">efc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we add margin = "mean_reference" to show that it is the default</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour [0,50,100,150]"</span>, margin <span class="op">=</span> <span class="st">"mean_reference"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     75.07 | 72.96, 77.19</span></span>
<span><span class="co">#&gt;      50 |     62.78 | 61.16, 64.40</span></span>
<span><span class="co">#&gt;     100 |     50.48 | 48.00, 52.97</span></span>
<span><span class="co">#&gt;     150 |     38.19 | 34.30, 42.08</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 = 11.83</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour [0,50,100,150]"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     75.07 | 72.96, 77.19</span></span>
<span><span class="co">#&gt;      50 |     62.78 | 61.16, 64.40</span></span>
<span><span class="co">#&gt;     100 |     50.48 | 48.00, 52.97</span></span>
<span><span class="co">#&gt;     150 |     38.19 | 34.30, 42.08</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 = 11.83</span></span></code></pre></div>
<p>As can be seen, the continuous predictor <code>neg_c_7</code> is held
constant at its mean value, 11.83. For categorical predictors,
<code>margin = "mean_reference"</code> (the default, and thus not
specified in the above example) and
<code>margin = "marginalmeans"</code> behave differently. While
<code>"mean_reference"</code> uses the reference level of each
categorical predictor to hold it constant, <code>"marginalmeans"</code>
averages over the proportions of the categories of factors.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/datawizard/" class="external-link">datawizard</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">efc</span>, package <span class="op">=</span> <span class="st">"ggeffects"</span><span class="op">)</span></span>
<span><span class="va">efc</span><span class="op">$</span><span class="va">e42dep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://easystats.github.io/datawizard/reference/to_factor.html" class="external-link">to_factor</a></span><span class="op">(</span><span class="va">efc</span><span class="op">$</span><span class="va">e42dep</span><span class="op">)</span></span>
<span><span class="co"># we add categorical predictors to our model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">barthtot</span> <span class="op">~</span> <span class="va">c12hour</span> <span class="op">+</span> <span class="va">neg_c_7</span> <span class="op">+</span> <span class="va">e42dep</span>, data <span class="op">=</span> <span class="va">efc</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour [0,50,100,150]"</span>, margin <span class="op">=</span> <span class="st">"mean_reference"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     92.74 | 88.48, 97.01</span></span>
<span><span class="co">#&gt;      50 |     89.18 | 84.82, 93.54</span></span>
<span><span class="co">#&gt;     100 |     85.61 | 80.79, 90.42</span></span>
<span><span class="co">#&gt;     150 |     82.04 | 76.49, 87.59</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 =       11.83</span></span>
<span><span class="co">#&gt; *  e42dep = independent</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour [0,50,100,150]"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     73.51 | 71.85, 75.18</span></span>
<span><span class="co">#&gt;      50 |     69.95 | 68.51, 71.38</span></span>
<span><span class="co">#&gt;     100 |     66.38 | 64.19, 68.56</span></span>
<span><span class="co">#&gt;     150 |     62.81 | 59.51, 66.10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 = 11.83</span></span></code></pre></div>
<p>In this case, one would obtain the same results for
<code>"mean_reference"</code> and <code>"marginalmeans"</code> again, if
<code>condition</code> is used to define specific levels at which
variables, in our case the factor <code>e42dep</code>, should be held
constant.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour [0,50,100,150]"</span>, margin <span class="op">=</span> <span class="st">"mean_reference"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     92.74 | 88.48, 97.01</span></span>
<span><span class="co">#&gt;      50 |     89.18 | 84.82, 93.54</span></span>
<span><span class="co">#&gt;     100 |     85.61 | 80.79, 90.42</span></span>
<span><span class="co">#&gt;     150 |     82.04 | 76.49, 87.59</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 =       11.83</span></span>
<span><span class="co">#&gt; *  e42dep = independent</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span></span>
<span>  <span class="va">fit</span>,</span>
<span>  <span class="st">"c12hour [0,50,100,150]"</span>,</span>
<span>  margin <span class="op">=</span> <span class="st">"marginalmeans"</span>,</span>
<span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>e42dep <span class="op">=</span> <span class="st">"independent"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     92.74 | 88.48, 97.01</span></span>
<span><span class="co">#&gt;      50 |     89.18 | 84.82, 93.54</span></span>
<span><span class="co">#&gt;     100 |     85.61 | 80.79, 90.42</span></span>
<span><span class="co">#&gt;     150 |     82.04 | 76.49, 87.59</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * neg_c_7 = 11.83</span></span></code></pre></div>
<p>Another option is to use
<code>predict_response(margin = "empirical")</code> to compute
“counterfactual” adjusted predictions. This function is a wrapper for
the <code><a href="https://rdrr.io/pkg/marginaleffects/man/predictions.html" class="external-link">avg_predictions()</a></code>-method from the
<strong>marginaleffects</strong>-package. The major difference to
<code>margin = "marginalmeans"</code> is that estimated marginal means,
as computed by <code>"marginalmeans"</code>, are a special case of
predictions, made on a perfectly balanced grid of categorical
predictors, with numeric predictors held at their means, and
marginalized with respect to some focal variables.</p>
<p><code>predict_response(margin = "empirical")</code>, in turn,
calculates predicted values for each observation in the data multiple
times, each time fixing the unique values or levels of the focal terms
to one specific value and then takes the average of these predicted
values (aggregated/grouped by the focal terms) - or in other words: the
whole dataset is duplicated once for every unique value of the focal
terms, makes predictions for each observation of the new dataset and
take the average of all predictions (grouped by focal terms). This is
also called “counterfactual” predictions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Average predicted values of Total score BARTHEL INDEX</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; c12hour | Predicted |       95% CI</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt;       0 |     67.73 | 66.15, 69.31</span></span>
<span><span class="co">#&gt;      20 |     66.30 | 65.03, 67.57</span></span>
<span><span class="co">#&gt;      45 |     64.52 | 63.38, 65.66</span></span>
<span><span class="co">#&gt;      65 |     63.09 | 61.81, 64.37</span></span>
<span><span class="co">#&gt;      85 |     61.66 | 60.07, 63.25</span></span>
<span><span class="co">#&gt;     105 |     60.23 | 58.24, 62.23</span></span>
<span><span class="co">#&gt;     125 |     58.81 | 56.37, 61.25</span></span>
<span><span class="co">#&gt;     170 |     55.59 | 52.08, 59.11</span></span></code></pre></div>
<p>To explain how <code>margin = "empirical"</code> works, let’s look at
following example, where we compute the average predicted values and the
estimated marginal means manually. The confidence intervals for the
manually calculated means differ from those of
<code><a href="../reference/predict_response.html">predict_response()</a></code>, however, the predicted and manually
calculated mean values are identical.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">iris</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">+</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># average predicted values</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Average predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Species    | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; -----------------------------------</span></span>
<span><span class="co">#&gt; setosa     |      3.43 | 3.34, 3.52</span></span>
<span><span class="co">#&gt; versicolor |      2.77 | 2.67, 2.86</span></span>
<span><span class="co">#&gt; virginica  |      2.97 | 2.88, 3.07</span></span>
<span></span>
<span><span class="co"># replicate the dataset for each level of "Species", i.e. 3 times</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">iris</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># for each data set, we set our focal term to one of the three levels</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">Species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># we calculate predicted values for each "dataset", i.e. we predict our outcome</span></span>
<span><span class="co"># for observations, for all levels of "Species"</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="co"># now we compute the average predicted values by levels of "Species", where</span></span>
<span><span class="co"># non-focal terms are weighted proportional to their occurence in the data</span></span>
<span><span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/means_by_group.html" class="external-link">means_by_group</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"predicted"</span>, <span class="st">"Species"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Mean of predicted by Species</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Category   | Mean |   N |   SD |       95% CI |      p</span></span>
<span><span class="co">#&gt; ------------------------------------------------------</span></span>
<span><span class="co">#&gt; setosa     | 3.43 | 150 | 0.06 | [3.42, 3.44] | &lt; .001</span></span>
<span><span class="co">#&gt; versicolor | 2.77 | 150 | 0.06 | [2.76, 2.78] | &lt; .001</span></span>
<span><span class="co">#&gt; virginica  | 2.97 | 150 | 0.06 | [2.96, 2.98] | &lt; .001</span></span>
<span><span class="co">#&gt; Total      | 3.06 | 450 | 0.28 |              |       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Anova: R2=0.951; adj.R2=0.951; F=4320.998; p&lt;.001</span></span>
<span></span>
<span><span class="co"># estimated marginal means, in turn, differ from the above, because they are</span></span>
<span><span class="co"># averaged across balanced reference grids for all focal terms, thereby non-focal</span></span>
<span><span class="co"># are hold constant at an (equally) "weighted average".</span></span>
<span></span>
<span><span class="co"># estimated marginal means, from `ggemmeans()`</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Species    | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; -----------------------------------</span></span>
<span><span class="co">#&gt; setosa     |      3.45 | 3.35, 3.54</span></span>
<span><span class="co">#&gt; versicolor |      2.78 | 2.68, 2.89</span></span>
<span><span class="co">#&gt; virginica  |      2.99 | 2.89, 3.09</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/new_data.html">data_grid</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/new_data.html">data_grid</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/new_data.html">data_grid</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"3"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/new_data.html">data_grid</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"4"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="co"># means calculated manually</span></span>
<span><span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/means_by_group.html" class="external-link">means_by_group</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"predicted"</span>, <span class="st">"Species"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Mean of predicted by Species</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Category   | Mean |  N |   SD |       95% CI |      p</span></span>
<span><span class="co">#&gt; -----------------------------------------------------</span></span>
<span><span class="co">#&gt; setosa     | 3.45 |  4 | 0.07 | [3.36, 3.53] | &lt; .001</span></span>
<span><span class="co">#&gt; versicolor | 2.78 |  4 | 0.07 | [2.70, 2.87] | &lt; .001</span></span>
<span><span class="co">#&gt; virginica  | 2.99 |  4 | 0.07 | [2.91, 3.07] | 0.019 </span></span>
<span><span class="co">#&gt; Total      | 3.07 | 12 | 0.30 |              |       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Anova: R2=0.952; adj.R2=0.941; F=88.566; p&lt;.001</span></span></code></pre></div>
<p><strong>But when should I use which <code>margin</code>
option?</strong></p>
<p>When you are interested in the strength of association, it usually
doesn’t matter. as you can see in the plots below. The slope of our
focal term, <code>c12hour</code>, is the same for all four plots:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/see/" class="external-link">see</a></span><span class="op">)</span></span>
<span><span class="va">predicted_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span><span class="op">)</span></span>
<span><span class="va">predicted_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span><span class="op">)</span></span>
<span><span class="va">predicted_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>e42dep <span class="op">=</span> <span class="st">"independent"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">predicted_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">fit</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predicted_1</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span>, show_title <span class="op">=</span> <span class="cn">FALSE</span>, show_x_title <span class="op">=</span> <span class="cn">FALSE</span>, show_y_title <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predicted_2</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span>, show_title <span class="op">=</span> <span class="cn">FALSE</span>, show_x_title <span class="op">=</span> <span class="cn">FALSE</span>, show_y_title <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predicted_3</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span>, show_title <span class="op">=</span> <span class="cn">FALSE</span>, show_x_title <span class="op">=</span> <span class="cn">FALSE</span>, show_y_title <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predicted_4</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span>, show_title <span class="op">=</span> <span class="cn">FALSE</span>, show_x_title <span class="op">=</span> <span class="cn">FALSE</span>, show_y_title <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://easystats.github.io/see/reference/plots.html" class="external-link">plots</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, n_rows <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="technical_differencepredictemmeans_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>However, the predicted outcome varies. The <a href="ggeffects.html">general introduction</a> discusses the
<code>margin</code> argument more in detail, but a few hints on when to
use which method are following:</p>
<ul>
<li><p>Predictions based on <code>"mean_reference"</code> and
<code>"mean_mode"</code> represent a rather “theoretical” view on your
data, which does not necessarily exactly reflect the characteristics of
your sample. It helps answer the question, “What is the predicted value
of the response at meaningful values or levels of my focal terms for a
‘typical’ observation in my data?”, where ‘typical’ refers to certain
characteristics of the remaining predictors.</p></li>
<li><p><code>"marginalmeans"</code> comes closer to the sample, because
it takes all possible values and levels of your non-focal predictors
into account. It would answer thr question, “What is the predicted value
of the response at meaningful values or levels of my focal terms for an
‘average’ observation in my data?”. It refers to randomly picking a
subject of your sample and the result you get on average.</p></li>
<li><p><code>"empirical"</code>is probably the most “realistic”
approach, insofar as the results can also be transferred to other
contexts. It answers the question, “What is the predicted value of the
response at meaningful values or levels of my focal terms for the
‘average’ observation in the population?”. It does not only refer to the
actual data in your sample, but also “what would be if” we had more
data, or if we had data from a different population. This is where
“counterfactual” refers to.</p></li>
</ul>
<p><strong>What is the most apparent difference from
<code>margin = "empirical"</code> to the other options?</strong></p>
<p>The most apparent difference from <code>margin = "empirical"</code>
compared to the other methods occurs when you have categorical
co-variates (<em>non-focal terms</em>) with unequally distributed
levels. <code>margin = "marginalmeans"</code> will “average” over the
levels of non-focal factors, while <code>margin = "empirical"</code>
will average over the observations in your sample.</p>
<p>Let’s show this with a very simple example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># create an unequal distributed factor, used as non-focal term</span></span>
<span><span class="va">iris</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">+</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># predicted values, conditioned on x = 1</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Species    | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; -----------------------------------</span></span>
<span><span class="co">#&gt; setosa     |      3.50 | 3.30, 3.69</span></span>
<span><span class="co">#&gt; versicolor |      2.84 | 2.63, 3.04</span></span>
<span><span class="co">#&gt; virginica  |      3.04 | 2.85, 3.23</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * x = 1</span></span>
<span></span>
<span><span class="co"># predicted values, conditioned on weighted average of x</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Species    | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; -----------------------------------</span></span>
<span><span class="co">#&gt; setosa     |      3.45 | 3.35, 3.54</span></span>
<span><span class="co">#&gt; versicolor |      2.78 | 2.68, 2.89</span></span>
<span><span class="co">#&gt; virginica  |      2.99 | 2.89, 3.09</span></span>
<span></span>
<span><span class="co"># average predicted values, averaged over the sample and aggregated by "Species"</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Average predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Species    | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; -----------------------------------</span></span>
<span><span class="co">#&gt; setosa     |      3.43 | 3.34, 3.52</span></span>
<span><span class="co">#&gt; versicolor |      2.77 | 2.67, 2.86</span></span>
<span><span class="co">#&gt; virginica  |      2.97 | 2.88, 3.07</span></span></code></pre></div>
<p>Finally, the weighting for <code>margin = "marginalmeans"</code> can
be changed using the <code>weights</code> argument (for details, see
<code><a href="https://rvlenth.github.io/emmeans/reference/emmeans.html" class="external-link">?emmeans::emmeans</a></code>), which returns results that are more
similar to <code>margin = "empirical"</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the default is an equally weighted average; "proportional" weights in</span></span>
<span><span class="co"># proportion to the  frequencies of factor combinations</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Species"</span>, margin <span class="op">=</span> <span class="st">"marginalmeans"</span>, weights <span class="op">=</span> <span class="st">"proportional"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Sepal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Species    | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; -----------------------------------</span></span>
<span><span class="co">#&gt; setosa     |      3.43 | 3.34, 3.52</span></span>
<span><span class="co">#&gt; versicolor |      2.77 | 2.67, 2.86</span></span>
<span><span class="co">#&gt; virginica  |      2.97 | 2.88, 3.07</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/strengejacke" class="external-link">Daniel Lüdecke</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
