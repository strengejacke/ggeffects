<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction: Adjusted Predictions and Marginal Effects for Random Effects Models • ggeffects</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction: Adjusted Predictions and Marginal Effects for Random Effects Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggeffects</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-introductions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Introductions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-introductions">
<li><a class="dropdown-item" href="../articles/ggeffects.html">Adjusted predictions of regression models</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_effectsatvalues.html">Adjusted predictions at specific values</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_randomeffects.html">Adjusted predictions for mixed models</a></li>
    <li><a class="dropdown-item" href="../articles/practical_robustestimation.html">(Cluster) Robust standard errors</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-interpretation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Interpretation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-interpretation">
<li><a class="dropdown-item" href="../articles/introduction_comparisons_1.html">Contrasts and pairwise comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_2.html">Slopes, floodlight and spotlight analysis</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_3.html">Contrasts and pairwise comparisons for GLM</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_4.html">Contrasts and pairwise comparisons for Zero-Inflation Models</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_5.html">Using marginaleffects or emmeans for comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_partial_residuals.html">Adding partial residuals to effects plots</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-plotting-and-printing" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Plotting and Printing</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-plotting-and-printing">
<li><a class="dropdown-item" href="../articles/introduction_plotmethod.html">Plotting adjusted predictions</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_plotcustomize.html">Customize plot appearance</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_print.html">Customize table appearance</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case Studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies">
<li><a class="dropdown-item" href="../articles/practical_glm_workflow.html">Simple workflow using logistic regression</a></li>
    <li><a class="dropdown-item" href="../articles/practical_logisticmixedmodel.html">Logistic mixed effects Model with interaction term</a></li>
    <li><a class="dropdown-item" href="../articles/practical_intersectionality.html">Intersectionality analysis using the MAIHDA framework</a></li>
    <li><a class="dropdown-item" href="../articles/practical_marginaleffects_pkg.html">Comparison of ggeffects and marginaleffects</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical-details" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical Details</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical-details">
<li><a class="dropdown-item" href="../articles/technical_differencepredictemmeans.html">Difference between marginalization methods</a></li>
    <li><a class="dropdown-item" href="../articles/technical_stata.html">Different Output between Stata and ggeffects</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/strengejacke/ggeffects/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction: Adjusted Predictions and Marginal Effects for Random Effects Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/strengejacke/ggeffects/blob/master/vignettes/introduction_randomeffects.Rmd" class="external-link"><code>vignettes/introduction_randomeffects.Rmd</code></a></small>
      <div class="d-none name"><code>introduction_randomeffects.Rmd</code></div>
    </div>

    
    
<style type="text/css">.callout-tip {
  border: solid 3px #fbd46d;
  border-radius: 5px;
  background-color: #f7fbe1;
  color: #303960;
  padding: 0px;
  margin-bottom: 1.5em;
  margin-top: 1.5em;
}

.callout-tip li {
  margin-bottom: 0.4em;
  margin-top: 0.4em;
  margin-right: 17px;
}

.indent_p {
  padding-left: 17px;
}

.callout-tip code {
  color: #d32626;
}

.callout-tip h1, .callout-tip h2 {
  font-size: 1.3em;
  color: #d32626;
  padding: 3px;
  padding-left: 15px;
  background-color: #fbd46d;
  margin-bottom: 15px;
  margin-top: 0px;
}</style>
<p>This vignette shows how to calculate adjusted predictions for mixed
models. However, for mixed models, since random effects are involved, we
can calculate <em>conditional predictions</em> and <em>marginal
predictions</em>. We also have to distinguish between
<em>population-level</em> and <em>unit-level</em> predictions.
Additionally, <em>random effects uncertainty</em> can be taken into
account, which would lead to <em>prediction intervals</em> instead of
<em>confidence intervals</em>.</p>
<p>But one thing at a time…</p>
<div class="callout-tip">
<h1>
<img src="../reference/figures/summary.png" width="20" height="17" style="vertical-align:middle">
Summary of most important points:
</h1>
<ul>
<li>
Predictions can be made on the population-level or for each level of the grouping variable (unit-level). If unit-level predictions are requested, you need to set 
<code>type="random"</code>
 and specify the grouping variable(s) in the 
<code>terms</code>
 argument.
</li>
<li>
Population-level predictions can be either conditional (predictions for a "typical" group) or marginal (average predictions across all groups). Set 
<code>margin="empirical"</code>
 for marginal predictions. You'll notice differences in predictions especially for unequal group sizes at the random effects level.
</li>
<li>
For conditional predictions, you can either calculate confidence or prediction intervals. Prediction intervals can be obtained by setting 
<code>type="random"</code>
. Marginal predictions (i.e. 
<code>margin="empirical"</code>
) always return confidence intervals.
</li>
<li>
To get condifence intervals for unit-level predictions, set 
<code>type="random"</code>
 and 
<code>interval="confidence"</code>
.
</li>
</ul>
</div>
<div class="section level3">
<h3 id="population-level-predictions-for-mixed-effects-models">Population-level predictions for mixed effects models<a class="anchor" aria-label="anchor" href="#population-level-predictions-for-mixed-effects-models"></a>
</h3>
<p>Mixed models are used to account for the dependency of observations
within groups, e.g. repeated measurements within subjects, or students
within schools. The dependency is modeled by random effects, i.e. mixed
model at least have one grouping variable (or factor) as higher level
unit.</p>
<p>At the lowest level, you have your <em>fixed effects</em>, i.e. your
“independent variables” or “predictors”.</p>
<p>Adjusted predictions can now be calculated for specified values or
levels of the focal terms, however, either for the full sample
(population-level) or for each level of the grouping variable
(unit-level). The latter is particularly useful when the grouping
variable is of interest, e.g. when you want to compare the effect of a
predictor between different groups.</p>
<div class="section level4">
<h4 id="conditional-and-marginal-effects-and-predictions">Conditional and marginal effects and predictions<a class="anchor" aria-label="anchor" href="#conditional-and-marginal-effects-and-predictions"></a>
</h4>
<p>We start with the population-level predictions. Here you can either
calculate the <em>conditional</em> or the <em>marginal</em> effect. The
conditional effect is the effect of a predictor in an average or typical
group, while the marginal effect is the average effect of a predictor
across all groups. E.g. let’s say we have <code>countries</code> as
grouping variable and <code>gdp</code> (gross domestic product per
capita) as predictor, then the conditional and marginal effect would
be:</p>
<ul>
<li><p>conditional effect: effect of <code>gdp</code> in an
<em>average</em> or <em>typical</em> country. To get conditional
predictions, we use <code><a href="../reference/predict_response.html">predict_response()</a></code> or
<code>predict_response(margin = "mean_mode")</code>.</p></li>
<li><p>marginal effect: average effect of <code>gdp</code> <em>across
all</em> countries. To get marginal (or average) predictions, we use
<code>predict_response(margin = "empirical")</code>.</p></li>
</ul>
<p>While the term “effect” referes to the strength of the relationship
between a predictor and the response, “predictions” refer to the actual
predicted values of the response. Thus, in the following, we will talk
about conditional and marginal (or average) <em>predictions</em>.</p>
<p>In a balanced data set, where all groups have the same number of
observations, the conditional and marginal predictions are often similar
(maybe slightly different, depending on the non-focal predictors).
However, in unbalanced data, the conditional and marginal predicted
values can largely differ.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/ggeffects/">ggeffects</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sleepstudy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># balanced data set</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># conditional predictions</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days [1,5,9]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    261.87 | 248.48, 275.27</span></span>
<span><span class="co">#&gt;    5 |    303.74 | 284.83, 322.65</span></span>
<span><span class="co">#&gt;    9 |    345.61 | 316.74, 374.48</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * Subject = 0 (population-level)</span></span>
<span></span>
<span><span class="co"># average marginal predictions</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days [1,5,9]"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Average predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    261.87 | 248.48, 275.27</span></span>
<span><span class="co">#&gt;    5 |    303.74 | 284.83, 322.65</span></span>
<span><span class="co">#&gt;    9 |    345.61 | 316.74, 374.48</span></span>
<span></span>
<span><span class="co"># create imbalanced data set</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">strapped</span> <span class="op">&lt;-</span> <span class="va">sleepstudy</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sleepstudy</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sleepstudy</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">strapped</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># conditional predictions</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days [1,5,9]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    261.49 | 246.57, 276.40</span></span>
<span><span class="co">#&gt;    5 |    302.13 | 281.30, 322.97</span></span>
<span><span class="co">#&gt;    9 |    342.78 | 311.19, 374.37</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * Subject = 0 (population-level)</span></span>
<span></span>
<span><span class="co"># average marginal predictions</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days [1,5,9]"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Average predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    259.04 | 244.13, 273.95</span></span>
<span><span class="co">#&gt;    5 |    300.01 | 279.17, 320.84</span></span>
<span><span class="co">#&gt;    9 |    340.97 | 309.37, 372.56</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="prediction-intervals-random-effects-uncertainty">Prediction intervals (random effects uncertainty)<a class="anchor" aria-label="anchor" href="#prediction-intervals-random-effects-uncertainty"></a>
</h4>
<p>For conditional predictions (i.e. when <code>margin</code> is not set
to <code>"empirical"</code>), the uncertainty of the random effects can
be taken into account. This leads to <em>prediction intervals</em>
instead of <em>confidence intervals</em>. To do so, we need to set
<code>type = "random"</code>.</p>
<p>The random-effect variance, which is included when
<code>type = "random"</code>, is the <em>mean</em> random-effect
variance. Calculation is based on the proposal from <em>Johnson et
al. 2014</em>, which is also implemented in functions like <a href="https://easystats.github.io/performance/reference/r2_nakagawa.html" class="external-link"><code>performance::r2()</code></a>
or <a href="https://easystats.github.io/insight/reference/get_variance.html" class="external-link"><code>insight::get_variance()</code></a>
to get r-squared values or random-effect variances for mixed models with
more complex random effects structures.</p>
<p>As can be seen, compared to the previous examples, predicted values
are identical (both on the population-level). However, standard errors,
and thus the resulting confidence (or prediction) intervals are much
larger .</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days [1,5,9]"</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    261.49 | 226.59, 296.38</span></span>
<span><span class="co">#&gt;    5 |    302.13 | 264.33, 339.94</span></span>
<span><span class="co">#&gt;    9 |    342.78 | 298.13, 387.43</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * Subject = 0 (population-level)</span></span>
<span></span>
<span><span class="co"># Or as comparison via plots:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">pr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days [1,5,9]"</span><span class="op">)</span></span>
<span><span class="va">pr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days [1,5,9]"</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">pr1</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Confidence Intervals"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">pr2</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Prediction Intervals"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>It is also possible to obtain predicted values by simulating from the
model, where predictions are based on <code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate()</a></code>. The
predicted values come closer to <em>marginal predictions</em> estimates,
but the intervals come closer to <em>prediction intervals</em>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days"</span>, type <span class="op">=</span> <span class="st">"simulate"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    0 |    250.22 | 218.68, 281.83</span></span>
<span><span class="co">#&gt;    1 |    261.51 | 230.34, 292.66</span></span>
<span><span class="co">#&gt;    2 |    265.33 | 234.51, 296.45</span></span>
<span><span class="co">#&gt;    3 |    279.24 | 247.73, 310.43</span></span>
<span><span class="co">#&gt;    5 |    286.54 | 255.42, 317.50</span></span>
<span><span class="co">#&gt;    6 |    332.07 | 301.25, 363.38</span></span>
<span><span class="co">#&gt;    7 |    336.58 | 305.70, 367.80</span></span>
<span><span class="co">#&gt;    9 |    331.56 | 300.30, 362.91</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="when-are-predictions-affected-by-type-fixed-and-type-random">When are predictions affected by <code>type = "fixed"</code> and
<code>type = "random"</code>?<a class="anchor" aria-label="anchor" href="#when-are-predictions-affected-by-type-fixed-and-type-random"></a>
</h4>
<p>The conditional predictions returned by
<code><a href="../reference/predict_response.html">predict_response()</a></code> for the default marginalization
(i.e. when <code>margin</code> is set to <code>"mean_reference"</code>
or <code>"mean_mode"</code>) may differ, depending on whether
<code>type = "fixed"</code> or <code>type = "random"</code> is used.
This is because <code>predict(..., re.form = NA)</code> is called for
<code>type = "fixed"</code>, and
<code>predict(..., re.form = NULL)</code> is called for
<code>type = "random"</code>, which can lead to different predictions
depending on whether <code>REML</code> was set to <code>TRUE</code> or
<code>FALSE</code> for model fitting.</p>
<p>When <code>REML = FALSE</code>, <code>re.form = NA</code> and
<code>re.form = NULL</code> are identical, and thus predictions are not
affected by <code>type = "fixed"</code> and
<code>type = "random"</code>. However, when <code>REML = TRUE</code>,
<code>re.form = NA</code> and <code>re.form = NULL</code> can return
different predictions, also depending on whether factors are included in
the model or not. The following example shows a case where predictions
are affected by <code>type = "fixed"</code> and
<code>type = "random"</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/glmmTMB/glmmTMB" class="external-link">glmmTMB</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">sleepstudy</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sleepstudy</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># REML is FALSE</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span>, REML <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># REML is TRUE</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span>, REML <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># predictions when REML is FALSE - no difference between type = "fixed"</span></span>
<span><span class="co"># and type = "random" in predictions, only for intervals</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m1</span>, <span class="st">"Days [1:3]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    260.22 | 245.82, 274.63</span></span>
<span><span class="co">#&gt;    2 |    270.69 | 255.77, 285.61</span></span>
<span><span class="co">#&gt;    3 |    281.16 | 265.19, 297.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; *       x = 1</span></span>
<span><span class="co">#&gt; * Subject = NA (population-level)</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m1</span>, <span class="st">"Days [1:3]"</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    260.22 | 208.07, 312.37</span></span>
<span><span class="co">#&gt;    2 |    270.69 | 218.40, 322.99</span></span>
<span><span class="co">#&gt;    3 |    281.16 | 228.56, 333.76</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; *       x = 1</span></span>
<span><span class="co">#&gt; * Subject = NA (population-level)</span></span>
<span></span>
<span><span class="co"># predictions when REML is TRUE - we now see a difference both</span></span>
<span><span class="co"># for intervals *and* predictions</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m2</span>, <span class="st">"Days [1:3]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    254.63 | 246.25, 263.02</span></span>
<span><span class="co">#&gt;    2 |    265.07 | 257.33, 272.81</span></span>
<span><span class="co">#&gt;    3 |    275.50 | 268.22, 282.78</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; *       x = 1</span></span>
<span><span class="co">#&gt; * Subject = NA (population-level)</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m2</span>, <span class="st">"Days[1:3]"</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    260.23 | 207.65, 312.80</span></span>
<span><span class="co">#&gt;    2 |    270.69 | 217.97, 323.42</span></span>
<span><span class="co">#&gt;    3 |    281.16 | 228.11, 334.21</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; *       x = 1</span></span>
<span><span class="co">#&gt; * Subject = NA (population-level)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="to-summarize">To summarize…<a class="anchor" aria-label="anchor" href="#to-summarize"></a>
</h4>
<p>For conditional predictions (i.e. the default marginalization method
in <code><a href="../reference/predict_response.html">predict_response()</a></code>), following differences can be
observed:</p>
<ul>
<li><p><code>type = "fixed"</code>: predictions are on the
population-level, and do not account for the random effect variances.
<code>re.form = NA</code> when calling <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>. Intervals
for the predicted values are <em>confidence intervals</em>.</p></li>
<li><p><code>type = "random"</code>: predictions are on the
population-level, but conditioned on the random effects (i.e. including
random effect variances). <code>re.form = NULL</code> when calling
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>. Intervals are <em>prediction
intervals</em>.</p></li>
<li><p><code>type = "random", interval = "confidence"</code>:
predictions are on the population-level, conditioned on the random
effects (which means that <code>re.form = NULL</code> when calling
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>), however, intervals are <em>confidence
intervals</em>.</p></li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="population-level-predictions-for-zero-inflated-mixed-models">Population-level predictions for zero-inflated mixed models<a class="anchor" aria-label="anchor" href="#population-level-predictions-for-zero-inflated-mixed-models"></a>
</h3>
<p>For zero-inflated mixed effects models, typically fitted with the
<strong>glmmTMB</strong> or <strong>GLMMadaptive</strong> packages,
<code><a href="../reference/predict_response.html">predict_response()</a></code> can return predicted values of the
response, conditioned on following prediction-types:</p>
<ul>
<li>the fixed effects of the conditional (or “count”) model only
(<code>type = "fixed"</code>)</li>
<li>the fixed effects of the conditional model only (population-level),
taking the random-effect variances into account, i.e. prediction
intervals are returned (<code>type = "random"</code>)</li>
<li>the fixed effects and zero-inflation component
(<code>type = "zero_inflated"</code>)</li>
<li>the fixed effects and zero-inflation component (population-level),
taking the random-effect variances into account, i.e. prediction
intervals are returned (<code>type = "zi_random"</code>)</li>
<li>the zero-inflation probabilities
(<code>type = "zi_prob"</code>)</li>
<li>all model parameters (<code>type = "simulate"</code>)</li>
</ul>
<p>For <code>predict_response(margin = "empirical")</code>,
<code>type = "simulate"</code> and <code>type = "random"</code> are not
available. However, valid values for <code>type</code> can also be those
based on the model’s <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method. For models of class
<code>glmmTMB</code>, these are <code>"response"</code>,
<code>"link"</code>, <code>"conditional"</code>, <code>"zprob"</code>,
<code>"zlink"</code>, or <code>"disp"</code>.</p>
<div class="section level4">
<h4 id="adjusted-predictions-for-the-conditional-model">Adjusted predictions for the conditional model<a class="anchor" aria-label="anchor" href="#adjusted-predictions-for-the-conditional-model"></a>
</h4>
<p>For now, we show examples for conditional predictions, which is the
default marginalization method in <code><a href="../reference/predict_response.html">predict_response()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/glmmTMB/glmmTMB" class="external-link">glmmTMB</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Salamanders</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span></span>
<span>  <span class="va">count</span> <span class="op">~</span> <span class="va">spp</span> <span class="op">+</span> <span class="va">mined</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">site</span><span class="op">)</span>,</span>
<span>  ziformula <span class="op">=</span> <span class="op">~</span> <span class="va">spp</span> <span class="op">+</span> <span class="va">mined</span>,</span>
<span>  family <span class="op">=</span> <span class="va">truncated_poisson</span>,</span>
<span>  data <span class="op">=</span> <span class="va">Salamanders</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Similar to mixed models without zero-inflation component,
<code>type = "fixed"</code> and <code>type = "random"</code> for
<strong>glmmTMB</strong>-models (with zero-inflation) both return
predictions on the population-level, where the latter option accounts
for the uncertainty of the random effects. For both,
<code>predict(..., type = "link")</code> is called (however, predicted
values are back-transformed to the response scale), and for the latter,
prediction intervals are returned.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"spp"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted (conditional) counts of count</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spp   | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; ------------------------------</span></span>
<span><span class="co">#&gt; GP    |      0.94 | 0.62, 1.40</span></span>
<span><span class="co">#&gt; PR    |      0.56 | 0.30, 1.02</span></span>
<span><span class="co">#&gt; DM    |      1.17 | 0.80, 1.70</span></span>
<span><span class="co">#&gt; EC-A  |      0.77 | 0.48, 1.23</span></span>
<span><span class="co">#&gt; EC-L  |      1.79 | 1.25, 2.55</span></span>
<span><span class="co">#&gt; DES-L |      1.71 | 1.20, 2.44</span></span>
<span><span class="co">#&gt; DF    |      0.98 | 0.67, 1.44</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * mined = yes</span></span>
<span><span class="co">#&gt; *  site = NA (population-level)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"spp"</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted (conditional) counts of count</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spp   | Predicted |      95% CI</span></span>
<span><span class="co">#&gt; -------------------------------</span></span>
<span><span class="co">#&gt; GP    |      0.94 | 0.13,  6.92</span></span>
<span><span class="co">#&gt; PR    |      0.56 | 0.07,  4.32</span></span>
<span><span class="co">#&gt; DM    |      1.17 | 0.16,  8.61</span></span>
<span><span class="co">#&gt; EC-A  |      0.77 | 0.10,  5.77</span></span>
<span><span class="co">#&gt; EC-L  |      1.79 | 0.24, 13.09</span></span>
<span><span class="co">#&gt; DES-L |      1.71 | 0.23, 12.56</span></span>
<span><span class="co">#&gt; DF    |      0.98 | 0.13,  7.22</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * mined = yes</span></span>
<span><span class="co">#&gt; *  site = NA (population-level)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adjusted-predictions-for-the-full-model">Adjusted predictions for the full model<a class="anchor" aria-label="anchor" href="#adjusted-predictions-for-the-full-model"></a>
</h4>
<p>For <code>type = "zero_inflated"</code>, the predicted response value
is the expected value <code>mu*(1-p)</code>. Since the zero inflation
and the conditional model are working in “opposite directions”, a higher
expected value for the zero inflation means a lower response, but a
higher value for the conditional (“count”) model means a higher
response. While it is possible to calculate predicted values with
<code>predict(..., type = "response")</code>, standard errors and
confidence intervals can not be derived directly from the
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>-function. Thus, confidence intervals for
<code>type = "zero_inflated"</code> are based on quantiles of simulated
draws from a multivariate normal distribution (see also <em>Brooks et
al. 2017, pp.391-392</em> for details).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"spp"</span>, type <span class="op">=</span> <span class="st">"zero_inflated"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Expected counts of count</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spp   | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; ------------------------------</span></span>
<span><span class="co">#&gt; GP    |      0.23 | 0.14, 0.32</span></span>
<span><span class="co">#&gt; PR    |      0.04 | 0.02, 0.06</span></span>
<span><span class="co">#&gt; DM    |      0.36 | 0.21, 0.50</span></span>
<span><span class="co">#&gt; EC-A  |      0.08 | 0.04, 0.11</span></span>
<span><span class="co">#&gt; EC-L  |      0.45 | 0.23, 0.67</span></span>
<span><span class="co">#&gt; DES-L |      0.53 | 0.28, 0.77</span></span>
<span><span class="co">#&gt; DF    |      0.33 | 0.20, 0.45</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * mined = yes</span></span>
<span><span class="co">#&gt; *  site = NA (population-level)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="simulated-outcome-full-model">Simulated outcome (full model)<a class="anchor" aria-label="anchor" href="#simulated-outcome-full-model"></a>
</h4>
<p>In the above example, we get the conditional, not the marginal
predictions (for example, not averaged over random effects groups).
Furthermore, predictions are conditioned on <code>mined</code> when it
is set to <code>"no"</code>. Therefore, it is possible to obtain
predicted values by simulating from the model, where predictions are
based on <code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate()</a></code> (see <em>Brooks et al. 2017,
pp.392-393</em> for details). This will return expected values of the
response, averaged across all random effects groups and non-focal terms.
To achieve this, use <code>type = "simulate"</code>. Note that intervals
of this type will be wider than those of
<code>type = "zero_inflated"</code>, because they account for the full
uncertainty of model parameters.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"spp"</span>, type <span class="op">=</span> <span class="st">"simulate"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Expected counts of count</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spp   | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; ------------------------------</span></span>
<span><span class="co">#&gt; GP    |      1.10 | 0.00, 4.14</span></span>
<span><span class="co">#&gt; PR    |      0.29 | 0.00, 2.25</span></span>
<span><span class="co">#&gt; DM    |      1.52 | 0.00, 5.26</span></span>
<span><span class="co">#&gt; EC-A  |      0.54 | 0.00, 3.08</span></span>
<span><span class="co">#&gt; EC-L  |      2.20 | 0.00, 7.17</span></span>
<span><span class="co">#&gt; DES-L |      2.28 | 0.00, 7.07</span></span>
<span><span class="co">#&gt; DF    |      1.32 | 0.00, 4.69</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="average-marginal-predictions-for-the-full-model">Average marginal predictions for the full model<a class="anchor" aria-label="anchor" href="#average-marginal-predictions-for-the-full-model"></a>
</h4>
<p>In a similar fashion, you can obtain average marginal predictions for
zero-inflated mixed models with <code>margin = "empirical"</code>. The
returned values are most comparable to
<code>predict_response(type = "simulate")</code>, because
<code>margin = "empirical"</code> also returns expected values of the
response, averaged across all random effects groups and all non-focal
terms. The next example shows the average marginal predicted values of
<code>spp</code> on the response across all <code>site</code>s, taking
the zero-inflation component into account
(i.e. <code>type = "zero_inflated"</code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"spp"</span>, type <span class="op">=</span> <span class="st">"zero_inflated"</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Average expected counts of count</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spp   | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; ------------------------------</span></span>
<span><span class="co">#&gt; GP    |      1.09 | 0.89, 1.29</span></span>
<span><span class="co">#&gt; PR    |      0.29 | 0.21, 0.38</span></span>
<span><span class="co">#&gt; DM    |      1.51 | 1.23, 1.80</span></span>
<span><span class="co">#&gt; EC-A  |      0.54 | 0.40, 0.67</span></span>
<span><span class="co">#&gt; EC-L  |      2.20 | 1.81, 2.59</span></span>
<span><span class="co">#&gt; DES-L |      2.27 | 1.88, 2.67</span></span>
<span><span class="co">#&gt; DF    |      1.31 | 1.07, 1.56</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="unit-level-predictions-predictions-for-each-level-of-random-effects">Unit-level predictions (predictions for each level of random
effects)<a class="anchor" aria-label="anchor" href="#unit-level-predictions-predictions-for-each-level-of-random-effects"></a>
</h3>
<p>Adjusted predictions can also be calculated for each group level
(unit-level) in mixed models. Simply add the name of the related random
effects term to the <code>terms</code>-argument, and set
<code>type = "random"</code>. For
<code>predict_response(margin = "empirical")</code>, you don’t need to
set <code>type = "random"</code>.</p>
<p>In the following example, we fit a linear mixed model and first
simply plot the adjusted predictions, <em>not</em> conditioned on
random-effect variances.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/sjlabelled/" class="external-link">sjlabelled</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">efc</span><span class="op">)</span></span>
<span><span class="va">efc</span><span class="op">$</span><span class="va">e15relat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://strengejacke.github.io/sjlabelled/reference/as_label.html" class="external-link">as_label</a></span><span class="op">(</span><span class="va">efc</span><span class="op">$</span><span class="va">e15relat</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">neg_c_7</span> <span class="op">~</span> <span class="va">c12hour</span> <span class="op">+</span> <span class="va">c160age</span> <span class="op">+</span> <span class="va">c161sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">e15relat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">efc</span><span class="op">)</span></span>
<span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>Changing the type to <code>type = "random"</code> still returns
population-level predictions by default. Recall that the major
difference between <code>type = "fixed"</code> and
<code>type = "random"</code> is the uncertainty in the variance
parameters. This leads to larger confidence intervals (i.e. prediction
intervals) for adjusted predictions with
<code>type = "random"</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>To compute adjusted predictions for each grouping level, add the
related random term to the <code>terms</code>-argument. In this case,
prediction intervals are calculated and predictions are conditioned on
each unit-level of the random effects.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c12hour"</span>, <span class="st">"e15relat"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>Since average marginal predictions already consider random effects by
averaging over the groups, the <code>type</code>-argument is not needed
when <code>margin = "empirical"</code> is set.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c12hour"</span>, <span class="st">"e15relat"</span><span class="op">)</span>, margin <span class="op">=</span> <span class="st">"empirical"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<p>Adjusted predictions, conditioned on random effects, can also be
calculated for specific unit-levels only. Add the related values into
brackets after the variable name in the <code>terms</code>-argument.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c12hour"</span>, <span class="st">"e15relat [child,sibling]"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>…and including prediction intervals…</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>The most complex plot in this scenario would be a term
(<code>c12hour</code>) at certain values of two other terms
(<code>c161sex</code>, <code>c160age</code>) for specific unit-levels of
random effects (<code>e15relat</code>), so we have four variables in the
<code>terms</code>-argument.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span></span>
<span>  <span class="va">m</span>,</span>
<span>  terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c12hour"</span>, <span class="st">"c161sex"</span>, <span class="st">"c160age"</span>, <span class="st">"e15relat [child,sibling]"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"random"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span>, n_rows <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>If the group factor has too many levels, you can also take a random
sample of all possible levels and plot the adjusted predictions for this
subsample of unit-levels. To do this, use
<code>term = "&lt;groupfactor&gt; [sample=n]"</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span><span class="op">)</span></span>
<span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m</span>, terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Days"</span>, <span class="st">"Subject [sample=7]"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
<p>You can also add the observed data points for each group using
<code>show_data = TRUE</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span>, show_data <span class="op">=</span> <span class="cn">TRUE</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
<div class="section level4">
<h4 id="prediction-and-confidence-intervals">Prediction and confidence intervals<a class="anchor" aria-label="anchor" href="#prediction-and-confidence-intervals"></a>
</h4>
<p>If unit-levels are of interest, setting <code>type = "random"</code>
is obligatory, unless you use
<code>predict_response(margin = "empirical")</code>. However, sometimes
it can be useful to have <em>confidence</em> instead of prediction
intervals, e.g. for <a href="introduction_comparisons_1">pairwise
comparisons</a> of random effects. Confidence instead of prediction
intervals can be calculated by explicitly setting
<code>interval = "confidence"</code>, in which case the random effects
variances are ignored.
<code>predict_response(margin = "empirical")</code> always returns
confidence intervals.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span></span>
<span>  <span class="va">m</span>,</span>
<span>  terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Days"</span>, <span class="st">"Subject [sample=7]"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"confidence"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># for average marginal effects, this would be:</span></span>
<span><span class="co"># predict_response(m, terms = c("Days", "Subject [sample=7]"), margin = "empirical")</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="population-level-predictions-for-gam-and-glmer-models">Population-level predictions for <code>gam</code> and
<code>glmer</code> models<a class="anchor" aria-label="anchor" href="#population-level-predictions-for-gam-and-glmer-models"></a>
</h3>
<p>The output of <code><a href="../reference/predict_response.html">predict_response()</a></code> indicates that the
grouping variable of the random effects is set to “population level”
(adjustment), e.g. in case of <em>lme4</em>, following is printed:</p>
<blockquote>
<p>Adjusted for: * Subject = 0 (population-level)</p>
</blockquote>
<p>A comparable model fitted with <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam()</a></code> would print a
different message:</p>
<blockquote>
<p>Adjusted for: * Subject = 308</p>
</blockquote>
<p>The reason is because the correctly printed information about
adjustment for random effects is based on
<code><a href="https://easystats.github.io/insight/reference/find_random.html" class="external-link">insight::find_random()</a></code>, which returns <code>NULL</code> for
<code>gam</code>s with random effects defined via
<code>s(..., bs = "re")</code>. However, predictions are still correct,
when population-level predictions are requested. Here’s an example:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sleepstudy"</span>, package <span class="op">=</span> <span class="st">"lme4"</span><span class="op">)</span></span>
<span><span class="co"># mixed model with lme4</span></span>
<span><span class="va">m_lmer</span> <span class="op">&lt;-</span> <span class="fu">lme4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">Days</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">sleepstudy</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># equivalent model, random effects are defined via s(..., bs = "re")</span></span>
<span><span class="va">m_gam</span> <span class="op">&lt;-</span> <span class="fu">mgcv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">Days</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">Subject</span>, bs <span class="op">=</span> <span class="st">"re"</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span>, method <span class="op">=</span> <span class="st">"ML"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># predictions are identical</span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m_gam</span>, terms <span class="op">=</span> <span class="st">"Days"</span>, exclude <span class="op">=</span> <span class="st">"s(Subject)"</span>, newdata.guaranteed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    0 |    255.45 | 235.12, 275.78</span></span>
<span><span class="co">#&gt;    1 |    263.22 | 244.71, 281.73</span></span>
<span><span class="co">#&gt;    2 |    271.67 | 253.70, 289.63</span></span>
<span><span class="co">#&gt;    3 |    280.78 | 262.75, 298.82</span></span>
<span><span class="co">#&gt;    5 |    301.05 | 282.84, 319.25</span></span>
<span><span class="co">#&gt;    6 |    312.19 | 294.15, 330.22</span></span>
<span><span class="co">#&gt;    7 |    324.00 | 306.03, 341.97</span></span>
<span><span class="co">#&gt;    9 |    349.65 | 329.33, 369.98</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * Subject = 308</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predict_response.html">predict_response</a></span><span class="op">(</span><span class="va">m_lmer</span>, terms <span class="op">=</span> <span class="st">"Days"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    0 |    255.45 | 234.79, 276.10</span></span>
<span><span class="co">#&gt;    1 |    263.22 | 244.35, 282.09</span></span>
<span><span class="co">#&gt;    2 |    271.67 | 253.33, 290.00</span></span>
<span><span class="co">#&gt;    3 |    280.78 | 262.38, 299.19</span></span>
<span><span class="co">#&gt;    5 |    301.05 | 282.48, 319.61</span></span>
<span><span class="co">#&gt;    6 |    312.19 | 293.78, 330.59</span></span>
<span><span class="co">#&gt;    7 |    324.00 | 305.66, 342.34</span></span>
<span><span class="co">#&gt;    9 |    349.65 | 329.00, 370.31</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * Subject = 0 (population-level)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Brooks ME, Kristensen K, Benthem KJ van, Magnusson A, Berg CW,
Nielsen A, et al. glmmTMB Balances Speed and Flexibility Among Packages
for Zero-inflated Generalized Linear Mixed Modeling. The R Journal.
2017;9: 378–400.</p>
<p>Johnson PC. 2014. Extension of Nakagawa &amp; Schielzeth’s R2GLMM to
random slopes models. Methods Ecol Evol, 5: 944-946. (doi:
10.1111/2041-210X.12225)</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/strengejacke" class="external-link">Daniel Lüdecke</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
