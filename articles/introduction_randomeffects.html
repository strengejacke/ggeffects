<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ggeffects">
<title>Introduction: Adjusted Predictions and Marginal Effects for Random Effects Models • ggeffects</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.8/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.8/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction: Adjusted Predictions and Marginal Effects for Random Effects Models">
<meta property="og:description" content="ggeffects">
<meta property="og:image" content="https://strengejacke.github.io/ggeffects/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ggeffects</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.4.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-introductions">Introductions</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-introductions">
    <a class="dropdown-item" href="../articles/ggeffects.html">Adjusted Predictions of Regression Models</a>
    <a class="dropdown-item" href="../articles/introduction_marginal_effects.html">Definition of Marginal Effects</a>
    <a class="dropdown-item" href="../articles/introduction_effectsatvalues.html">Adjusted Predictions at Specific Values</a>
    <a class="dropdown-item" href="../articles/introduction_randomeffects.html">Adjusted Predictions for Random Effects Models</a>
    <a class="dropdown-item" href="../articles/practical_robustestimation.html">(Cluster) Robust Standard Errors</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-interpretation">Interpretation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-interpretation">
    <a class="dropdown-item" href="../articles/introduction_comparisons_1.html">Contrasts and pairwise comparisons</a>
    <a class="dropdown-item" href="../articles/introduction_comparisons_2.html">Slopes, floodlight and spotlight analysis</a>
    <a class="dropdown-item" href="../articles/introduction_comparisons_3.html">Contrasts and pairwise comparisons for GLM</a>
    <a class="dropdown-item" href="../articles/introduction_partial_residuals.html">Adding Partial Residuals to Effects Plots</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-plotting-and-printing">Plotting and Printing</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-plotting-and-printing">
    <a class="dropdown-item" href="../articles/introduction_plotmethod.html">Plotting Adjusted Predictions</a>
    <a class="dropdown-item" href="../articles/introduction_plotcustomize.html">Customize Plot Appearance</a>
    <a class="dropdown-item" href="../articles/introduction_print.html">Customize Table Appearance</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-case-studies">Case Studies</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-case-studies">
    <a class="dropdown-item" href="../articles/practical_logisticmixedmodel.html">Logistic Mixed Effects Model with Interaction Term</a>
    <a class="dropdown-item" href="../articles/practical_intersectionality.html">Intersectionality analysis using the MAIHDA framework</a>
    <a class="dropdown-item" href="../articles/practical_marginaleffects_pkg.html">Comparison of ggeffects and marginaleffects</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-technical-details">Technical Details</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-technical-details">
    <a class="dropdown-item" href="../articles/technical_differencepredictemmeans.html">Difference between ggpredict(), ggemmeans() and ggaverage()</a>
    <a class="dropdown-item" href="../articles/technical_stata.html">Different Output between Stata and ggeffects</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/strengejacke/ggeffects/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction: Adjusted Predictions and Marginal Effects for Random Effects Models</h1>
                        <h4 data-toc-skip class="author">Daniel
Lüdecke</h4>
            
            <h4 data-toc-skip class="date">2024-01-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/strengejacke/ggeffects/blob/HEAD/vignettes/introduction_randomeffects.Rmd" class="external-link"><code>vignettes/introduction_randomeffects.Rmd</code></a></small>
      <div class="d-none name"><code>introduction_randomeffects.Rmd</code></div>
    </div>

    
    
<p>This vignette shows how to calculate adjusted predictions that take
the random-effect variances for mixed models into account.</p>
<div class="section level3">
<h3 id="population-level-predictions-for-mixed-effects-models">Population-level predictions for mixed effects models<a class="anchor" aria-label="anchor" href="#population-level-predictions-for-mixed-effects-models"></a>
</h3>
<p>Basically, the type of predictions, i.e. whether to account for the
uncertainty of random effects or not, can be set with the
<code>type</code>-argument. The default, <code>type = "fixed"</code>,
means that predictions are on the population-level and do not account
for the random effect variances. Intervals are <em>confidence
intervals</em> for the predicted values.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/ggeffects/">ggeffects</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sleepstudy</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days"</span><span class="op">)</span></span>
<span><span class="va">pr</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    0 |    251.41 | 237.94, 264.87</span></span>
<span><span class="co">#&gt;    1 |    261.87 | 248.48, 275.27</span></span>
<span><span class="co">#&gt;    2 |    272.34 | 258.34, 286.34</span></span>
<span><span class="co">#&gt;    3 |    282.81 | 267.60, 298.02</span></span>
<span><span class="co">#&gt;    5 |    303.74 | 284.83, 322.65</span></span>
<span><span class="co">#&gt;    6 |    314.21 | 293.03, 335.39</span></span>
<span><span class="co">#&gt;    7 |    324.68 | 301.05, 348.31</span></span>
<span><span class="co">#&gt;    9 |    345.61 | 316.74, 374.48</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * Subject = 0 (population-level)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">pr</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<div class="section level4">
<h4 id="prediction-intervals">Prediction intervals<a class="anchor" aria-label="anchor" href="#prediction-intervals"></a>
</h4>
<p>When <code>type = "random"</code>, the predicted <em>values</em> are
still on the <em>population-level</em>, but conditioned on the
random-effect variances (individual level predictions), which means that
<code>re.form = NULL</code> when calling <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>. This
<em>may</em> affect the returned predicted values, depending on whether
<code>REML = TRUE</code> or <code>REML = FALSE</code> was used for model
fitting.</p>
<p>Furthermore, when <code>type = "random"</code>, the random-effect
<em>variances</em> are taken into account, meaning that the intervals
are actually <em>prediction intervals</em> and become larger. More
technically speaking, <code>type = "random"</code> accounts for the
uncertainty of the fixed effects <em>conditional on the estimates</em>
of the random-effect variances and conditional modes (BLUPs).</p>
<p>Predicted values are <em>not</em> on the population-level when a
particular group (from the random effects) is specified in the
<code>condition</code> or <code>terms</code> arguments. See examples
below (section <em>Unit-level predictions (predictions for each level of
random effects)</em>) for details.</p>
<p>The random-effect variance is the <em>mean</em> random-effect
variance. Calculation is based on the proposal from <em>Johnson et
al. 2014</em>, which is also implemented in functions like <a href="https://easystats.github.io/performance/reference/r2_nakagawa.html" class="external-link"><code>performance::r2()</code></a>
or <a href="https://easystats.github.io/insight/reference/get_variance.html" class="external-link"><code>insight::get_variance()</code></a>
to get r-squared values or random-effect variances for mixed models with
more complex random effects structures.</p>
<p>As can be seen, compared to the previous example with
<code>type = "fixed"</code>, predicted values are identical (both on the
population-level). However, standard errors, and thus the resulting
confidence (or prediction) intervals are much larger .</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days"</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="va">pr</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    0 |    251.41 | 199.13, 303.68</span></span>
<span><span class="co">#&gt;    1 |    261.87 | 209.62, 314.13</span></span>
<span><span class="co">#&gt;    2 |    272.34 | 219.92, 324.75</span></span>
<span><span class="co">#&gt;    3 |    282.81 | 230.06, 335.56</span></span>
<span><span class="co">#&gt;    5 |    303.74 | 249.81, 357.68</span></span>
<span><span class="co">#&gt;    6 |    314.21 | 259.44, 368.98</span></span>
<span><span class="co">#&gt;    7 |    324.68 | 268.91, 380.44</span></span>
<span><span class="co">#&gt;    9 |    345.61 | 287.43, 403.79</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * Subject = 0 (population-level)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">pr</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="conditional-predictions-at-the-population-level">Conditional predictions at the population-level<a class="anchor" aria-label="anchor" href="#conditional-predictions-at-the-population-level"></a>
</h4>
<p>The reason why both <code>type = "fixed"</code> and
<code>type = "random"</code> return predictions at population-level is
because <code><a href="../reference/ggpredict.html">ggpredict()</a></code> returns predicted values of the
response <em>at specific levels</em> of given model predictors, which
are defined in the data frame that is passed to the
<code>newdata</code>-argument (of <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>). The data
frame requires data from <em>all</em> model terms, including random
effect terms. This again requires to choose certain levels or values
also for each random effect term, or to set those terms to zero or
<code>NA</code> (for population-level). Since there is no general rule,
which unit-level(s) (i.e. level(s) of random effect terms) to choose in
order to represent the random effects structure in the data, using the
population-level seems the most clear and consistent approach.</p>
<p>To get predicted values for a specific unit-level of the random
effect term, simply define this level in the
<code>condition</code>-argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days"</span>, type <span class="op">=</span> <span class="st">"random"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Subject <span class="op">=</span> <span class="fl">330</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    0 |    275.10 | 222.82, 327.37</span></span>
<span><span class="co">#&gt;    1 |    280.75 | 228.49, 333.01</span></span>
<span><span class="co">#&gt;    2 |    286.40 | 233.99, 338.82</span></span>
<span><span class="co">#&gt;    3 |    292.05 | 239.30, 344.80</span></span>
<span><span class="co">#&gt;    5 |    303.36 | 249.43, 357.29</span></span>
<span><span class="co">#&gt;    6 |    309.01 | 254.24, 363.79</span></span>
<span><span class="co">#&gt;    7 |    314.67 | 258.90, 370.43</span></span>
<span><span class="co">#&gt;    9 |    325.97 | 267.79, 384.15</span></span></code></pre></div>
<p>Finally, it is possible to obtain predicted values by simulating from
the model, where predictions are based on <code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"Days"</span>, type <span class="op">=</span> <span class="st">"simulate"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    0 |    251.58 | 200.73, 301.26</span></span>
<span><span class="co">#&gt;    1 |    261.94 | 211.91, 312.24</span></span>
<span><span class="co">#&gt;    2 |    272.49 | 222.14, 322.05</span></span>
<span><span class="co">#&gt;    3 |    282.65 | 233.38, 331.37</span></span>
<span><span class="co">#&gt;    5 |    304.12 | 254.91, 353.61</span></span>
<span><span class="co">#&gt;    6 |    313.76 | 263.74, 363.98</span></span>
<span><span class="co">#&gt;    7 |    324.89 | 275.31, 374.50</span></span>
<span><span class="co">#&gt;    9 |    345.35 | 294.95, 395.19</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="when-are-predictions-affected-by-type-fixed-and-type-random">When are predictions affected by <code>type = "fixed"</code> and
<code>type = "random"</code>?<a class="anchor" aria-label="anchor" href="#when-are-predictions-affected-by-type-fixed-and-type-random"></a>
</h4>
<p>When <code>type = "fixed"</code>, <code><a href="../reference/ggpredict.html">ggpredict()</a></code> calls
<code>predict(..., re.form = NA)</code>. For
<code>type = "random"</code>, <code>predict(..., re.form = NULL)</code>
is called. This can lead to different predictions, depending on whether
<code>REML = TRUE</code> or <code>REML = FALSE</code> was used for model
fitting. When <code>REML = FALSE</code>, <code>re.form = NA</code> and
<code>re.form = NULL</code> are identical, and thus predictions are not
affected by <code>type = "fixed"</code> and
<code>type = "random"</code>. However, when <code>REML = TRUE</code>,
<code>re.form = NA</code> and <code>re.form = NULL</code> can return
different predictions, also depending on whether factors are included in
the model or not. The following example shows a case where predictions
are affected by <code>type = "fixed"</code> and
<code>type = "random"</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/glmmTMB/glmmTMB" class="external-link">glmmTMB</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">sleepstudy</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sleepstudy</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># REML is FALSE</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span>, REML <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># REML is TRUE</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span>, REML <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># predictions when REML is FALSE - no difference between type = "fixed"</span></span>
<span><span class="co"># and type = "random" in predictions, only for intervals</span></span>
<span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m1</span>, <span class="st">"Days [1:3]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    260.22 | 245.82, 274.63</span></span>
<span><span class="co">#&gt;    2 |    270.69 | 255.77, 285.61</span></span>
<span><span class="co">#&gt;    3 |    281.16 | 265.19, 297.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; *       x = 1</span></span>
<span><span class="co">#&gt; * Subject = NA (population-level)</span></span>
<span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m1</span>, <span class="st">"Days [1:3]"</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    260.22 | 208.07, 312.37</span></span>
<span><span class="co">#&gt;    2 |    270.69 | 218.40, 322.99</span></span>
<span><span class="co">#&gt;    3 |    281.16 | 228.56, 333.76</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; *       x = 1</span></span>
<span><span class="co">#&gt; * Subject = NA (population-level)</span></span>
<span></span>
<span><span class="co"># predictions when REML is TRUE - we now see a difference both</span></span>
<span><span class="co"># for intervals *and* predictions</span></span>
<span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m2</span>, <span class="st">"Days [1:3]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    254.63 | 246.25, 263.02</span></span>
<span><span class="co">#&gt;    2 |    265.07 | 257.33, 272.81</span></span>
<span><span class="co">#&gt;    3 |    275.50 | 268.22, 282.78</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; *       x = 1</span></span>
<span><span class="co">#&gt; * Subject = NA (population-level)</span></span>
<span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m2</span>, <span class="st">"Days[1:3]"</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    1 |    260.23 | 207.65, 312.80</span></span>
<span><span class="co">#&gt;    2 |    270.69 | 217.97, 323.42</span></span>
<span><span class="co">#&gt;    3 |    281.16 | 228.11, 334.21</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; *       x = 1</span></span>
<span><span class="co">#&gt; * Subject = NA (population-level)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="to-summarize">To summarize…<a class="anchor" aria-label="anchor" href="#to-summarize"></a>
</h4>
<ul>
<li><p><code>type = "fixed"</code>: predictions are on the
population-level, and do not account for the random effect variances.
Intervals are <em>confidence intervals</em> for the predicted values.
<code>re.form = NA</code> when calling <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>.</p></li>
<li><p><code>type = "random"</code>: predictions are on the
population-level, but conditioned on the random effects (individual
level predictions), which means that <code>re.form = NULL</code> when
calling <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>. Intervals are <em>prediction
intervals</em>.</p></li>
<li><p><code>type = "random", interval = "confidence"</code>:
predictions are on the population-level, conditioned on the random
effects (which means that <code>re.form = NULL</code> when calling
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>), however, intervals are <em>confidence
intervals</em>.</p></li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="population-level-predictions-for-gam-and-glmer-models">Population-level predictions for <code>gam</code> and
<code>glmer</code> models<a class="anchor" aria-label="anchor" href="#population-level-predictions-for-gam-and-glmer-models"></a>
</h3>
<p>The output of <code><a href="../reference/ggpredict.html">ggpredict()</a></code> indicates that the grouping
variable of the random effects is set to “population level”
(adjustment), e.g. in case of <em>lme4</em>, following is printed:</p>
<blockquote>
<p>Adjusted for: * Subject = 0 (population-level)</p>
</blockquote>
<p>A comparable model fitted with <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam()</a></code> would print a
different message:</p>
<blockquote>
<p>Adjusted for: * Subject = 308</p>
</blockquote>
<p>The reason is because the correctly printed information about
adjustment for random effects is based on
<code><a href="https://easystats.github.io/insight/reference/find_random.html" class="external-link">insight::find_random()</a></code>, which returns <code>NULL</code> for
<code>gam</code>s with random effects defined via
<code>s(..., bs = "re")</code>. However, predictions are still correct,
when population-level predictions are requested. Here’s an example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sleepstudy"</span>, package <span class="op">=</span> <span class="st">"lme4"</span><span class="op">)</span></span>
<span><span class="co"># mixed model with lme4</span></span>
<span><span class="va">m_lmer</span> <span class="op">&lt;-</span> <span class="fu">lme4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">Days</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">sleepstudy</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># equivalent model, random effects are defined via s(..., bs = "re")</span></span>
<span><span class="va">m_gam</span> <span class="op">&lt;-</span> <span class="fu">mgcv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">Days</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">Subject</span>, bs <span class="op">=</span> <span class="st">"re"</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span>, method <span class="op">=</span> <span class="st">"ML"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># predictions are identical</span></span>
<span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m_gam</span>, terms <span class="op">=</span> <span class="st">"Days"</span>, exclude <span class="op">=</span> <span class="st">"s(Subject)"</span>, newdata.guaranteed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    0 |    255.45 | 235.12, 275.78</span></span>
<span><span class="co">#&gt;    1 |    263.22 | 244.71, 281.73</span></span>
<span><span class="co">#&gt;    2 |    271.67 | 253.70, 289.63</span></span>
<span><span class="co">#&gt;    3 |    280.78 | 262.75, 298.82</span></span>
<span><span class="co">#&gt;    5 |    301.05 | 282.84, 319.25</span></span>
<span><span class="co">#&gt;    6 |    312.19 | 294.15, 330.22</span></span>
<span><span class="co">#&gt;    7 |    324.00 | 306.03, 341.97</span></span>
<span><span class="co">#&gt;    9 |    349.65 | 329.33, 369.98</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * Subject = 308</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m_lmer</span>, terms <span class="op">=</span> <span class="st">"Days"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted values of Reaction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days | Predicted |         95% CI</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt;    0 |    255.45 | 234.79, 276.10</span></span>
<span><span class="co">#&gt;    1 |    263.22 | 244.35, 282.09</span></span>
<span><span class="co">#&gt;    2 |    271.67 | 253.33, 290.00</span></span>
<span><span class="co">#&gt;    3 |    280.78 | 262.38, 299.19</span></span>
<span><span class="co">#&gt;    5 |    301.05 | 282.48, 319.61</span></span>
<span><span class="co">#&gt;    6 |    312.19 | 293.78, 330.59</span></span>
<span><span class="co">#&gt;    7 |    324.00 | 305.66, 342.34</span></span>
<span><span class="co">#&gt;    9 |    349.65 | 329.00, 370.31</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * Subject = 0 (population-level)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adjusted-predictions-for-zero-inflated-mixed-models">Adjusted predictions for zero-inflated mixed models<a class="anchor" aria-label="anchor" href="#adjusted-predictions-for-zero-inflated-mixed-models"></a>
</h3>
<p>For zero-inflated mixed effects models, typically fitted with the
<strong>glmmTMB</strong> or <strong>GLMMadaptive</strong> packages,
predicted values can be conditioned on</p>
<ul>
<li>the fixed effects of the conditional model only
(<code>type = "fixed"</code>)</li>
<li>the fixed effects and zero-inflation component
(<code>type = "zero_inflated"</code>)</li>
<li>the fixed effects of the conditional model only (population-level),
taking the random-effect variances into account
(<code>type = "random"</code>)</li>
<li>the fixed effects and zero-inflation component (population-level),
taking the random-effect variances into account
(<code>type = "zi_random"</code>)</li>
<li>all model parameters (<code>type = "simulate"</code>)</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/glmmTMB/glmmTMB" class="external-link">glmmTMB</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Salamanders</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span></span>
<span>  <span class="va">count</span> <span class="op">~</span> <span class="va">spp</span> <span class="op">+</span> <span class="va">mined</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">site</span><span class="op">)</span>,</span>
<span>  ziformula <span class="op">=</span> <span class="op">~</span> <span class="va">spp</span> <span class="op">+</span> <span class="va">mined</span>,</span>
<span>  family <span class="op">=</span> <span class="va">truncated_poisson</span>,</span>
<span>  data <span class="op">=</span> <span class="va">Salamanders</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Similar to mixed models without zero-inflation component,
<code>type = "fixed"</code> and <code>type = "random"</code> for
<strong>glmmTMB</strong>-models (with zero-inflation) both return
predictions on the population-level, where the latter option accounts
for the uncertainty of the random effects. In short,
<code>predict(..., type = "link")</code> is called (however, predicted
values are back-transformed to the response scale).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"spp"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted counts of count</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spp   | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; ------------------------------</span></span>
<span><span class="co">#&gt; GP    |      0.94 | 0.62, 1.40</span></span>
<span><span class="co">#&gt; PR    |      0.56 | 0.30, 1.02</span></span>
<span><span class="co">#&gt; DM    |      1.17 | 0.80, 1.70</span></span>
<span><span class="co">#&gt; EC-A  |      0.77 | 0.48, 1.23</span></span>
<span><span class="co">#&gt; EC-L  |      1.79 | 1.25, 2.55</span></span>
<span><span class="co">#&gt; DES-L |      1.71 | 1.20, 2.44</span></span>
<span><span class="co">#&gt; DF    |      0.98 | 0.67, 1.44</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * mined = yes</span></span>
<span><span class="co">#&gt; *  site = NA (population-level)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"spp"</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted counts of count</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spp   | Predicted |      95% CI</span></span>
<span><span class="co">#&gt; -------------------------------</span></span>
<span><span class="co">#&gt; GP    |      0.94 | 0.13,  6.92</span></span>
<span><span class="co">#&gt; PR    |      0.56 | 0.07,  4.32</span></span>
<span><span class="co">#&gt; DM    |      1.17 | 0.16,  8.61</span></span>
<span><span class="co">#&gt; EC-A  |      0.77 | 0.10,  5.77</span></span>
<span><span class="co">#&gt; EC-L  |      1.79 | 0.24, 13.09</span></span>
<span><span class="co">#&gt; DES-L |      1.71 | 0.23, 12.56</span></span>
<span><span class="co">#&gt; DF    |      0.98 | 0.13,  7.22</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * mined = yes</span></span>
<span><span class="co">#&gt; *  site = NA (population-level)</span></span></code></pre></div>
<p>For <code>type = "zero_inflated"</code>, the predicted response value
is the expected value <code>mu*(1-p)</code> <em>without
conditioning</em> on random effects. Since the zero inflation and the
conditional model are working in “opposite directions”, a higher
expected value for the zero inflation means a lower response, but a
higher value for the conditional model means a higher response. While it
is possible to calculate predicted values with
<code>predict(..., type = "response")</code>, standard errors and
confidence intervals can not be derived directly from the
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>-function. Thus, confidence intervals for
<code>type = "zero_inflated"</code> are based on quantiles of simulated
draws from a multivariate normal distribution (see also <em>Brooks et
al. 2017, pp.391-392</em> for details).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"spp"</span>, type <span class="op">=</span> <span class="st">"zero_inflated"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted counts of count</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spp   | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; ------------------------------</span></span>
<span><span class="co">#&gt; GP    |      0.23 | 0.13, 0.32</span></span>
<span><span class="co">#&gt; PR    |      0.04 | 0.02, 0.06</span></span>
<span><span class="co">#&gt; DM    |      0.36 | 0.21, 0.50</span></span>
<span><span class="co">#&gt; EC-A  |      0.08 | 0.05, 0.11</span></span>
<span><span class="co">#&gt; EC-L  |      0.45 | 0.23, 0.67</span></span>
<span><span class="co">#&gt; DES-L |      0.53 | 0.29, 0.77</span></span>
<span><span class="co">#&gt; DF    |      0.33 | 0.20, 0.45</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * mined = yes</span></span>
<span><span class="co">#&gt; *  site = NA (population-level)</span></span></code></pre></div>
<p>For <code>type = "zi_random"</code>, the predicted response value is
the expected value <code>mu*(1-p)</code>, accounting for the
random-effect variances. Intervals are calculated in the same way as for
<code>type = "zero_inflated"</code>, except that the mean random effect
variance is considered and thus <em>prediction intervals</em> rather
than confidence intervals are returned.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"spp"</span>, type <span class="op">=</span> <span class="st">"zi_random"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted counts of count</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spp   | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; ------------------------------</span></span>
<span><span class="co">#&gt; GP    |      0.23 | 0.02, 2.23</span></span>
<span><span class="co">#&gt; PR    |      0.04 | 0.00, 0.41</span></span>
<span><span class="co">#&gt; DM    |      0.36 | 0.03, 3.47</span></span>
<span><span class="co">#&gt; EC-A  |      0.08 | 0.01, 0.80</span></span>
<span><span class="co">#&gt; EC-L  |      0.45 | 0.03, 4.65</span></span>
<span><span class="co">#&gt; DES-L |      0.53 | 0.04, 5.43</span></span>
<span><span class="co">#&gt; DF    |      0.33 | 0.03, 3.24</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjusted for:</span></span>
<span><span class="co">#&gt; * mined = yes</span></span>
<span><span class="co">#&gt; *  site = NA (population-level)</span></span></code></pre></div>
<p>Finally, it is possible to obtain predicted values by simulating from
the model, where predictions are based on <code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate()</a></code> (see
<em>Brooks et al. 2017, pp.392-393</em> for details). To achieve this,
use <code>type = "simulate"</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"spp"</span>, type <span class="op">=</span> <span class="st">"simulate"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Predicted counts of count</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spp   | Predicted |     95% CI</span></span>
<span><span class="co">#&gt; ------------------------------</span></span>
<span><span class="co">#&gt; GP    |      1.10 | 0.00, 4.11</span></span>
<span><span class="co">#&gt; PR    |      0.29 | 0.00, 2.28</span></span>
<span><span class="co">#&gt; DM    |      1.51 | 0.00, 5.28</span></span>
<span><span class="co">#&gt; EC-A  |      0.53 | 0.00, 3.02</span></span>
<span><span class="co">#&gt; EC-L  |      2.19 | 0.00, 7.12</span></span>
<span><span class="co">#&gt; DES-L |      2.27 | 0.00, 7.04</span></span>
<span><span class="co">#&gt; DF    |      1.33 | 0.00, 4.67</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="unit-level-predictions-predictions-for-each-level-of-random-effects">Unit-level predictions (predictions for each level of random
effects)<a class="anchor" aria-label="anchor" href="#unit-level-predictions-predictions-for-each-level-of-random-effects"></a>
</h3>
<p>Adjusted predictions can also be calculated for each group level
(unit-level) in mixed models. Simply add the name of the related random
effects term to the <code>terms</code>-argument, and set
<code>type = "random"</code>.</p>
<p>In the following example, we fit a linear mixed model and first
simply plot the adjusted predictions, <em>not</em> conditioned on
random-effect variances.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/sjlabelled/" class="external-link">sjlabelled</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">efc</span><span class="op">)</span></span>
<span><span class="va">efc</span><span class="op">$</span><span class="va">e15relat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://strengejacke.github.io/sjlabelled/reference/as_label.html" class="external-link">as_label</a></span><span class="op">(</span><span class="va">efc</span><span class="op">$</span><span class="va">e15relat</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">neg_c_7</span> <span class="op">~</span> <span class="va">c12hour</span> <span class="op">+</span> <span class="va">c160age</span> <span class="op">+</span> <span class="va">c161sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">e15relat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">efc</span><span class="op">)</span></span>
<span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>Changing the type to <code>type = "random"</code> still returns
population-level predictions by default. Recall that the major
difference between <code>type = "fixed"</code> and
<code>type = "random"</code> is the uncertainty in the variance
parameters. This leads to larger confidence intervals (i.e. prediction
intervals) for adjusted predictions with
<code>type = "random"</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, terms <span class="op">=</span> <span class="st">"c12hour"</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>To compute adjusted predictions for each grouping level, add the
related random term to the <code>terms</code>-argument. In this case,
prediction intervals are calculated and predictions are conditioned on
each unit-level of the random effects.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c12hour"</span>, <span class="st">"e15relat"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<blockquote>
<p>When predictions for unit-levels (random effects) are of interest, it
can be useful to calculate confidence instead of prediction intervals
(i.e. to ignore the uncertainty in the variance parameters and return
regular confidence intervals), in particular, when
<code><a href="../reference/hypothesis_test.html">hypothesis_test()</a></code> is used for contrasts or comparisons of
unit-levels (aka group levels). In that case, set
<code>interval = "confidence"</code> (see examples below).</p>
</blockquote>
<p>Adjusted predictions, conditioned on random effects, can also be
calculated for specific unit-levels only. Add the related values into
brackets after the variable name in the <code>terms</code>-argument.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c12hour"</span>, <span class="st">"e15relat [child,sibling]"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<p>…and including prediction intervals…</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>The most complex plot in this scenario would be a term
(<code>c12hour</code>) at certain values of two other terms
(<code>c161sex</code>, <code>c160age</code>) for specific unit-levels of
random effects (<code>e15relat</code>), so we have four variables in the
<code>terms</code>-argument.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span></span>
<span>  <span class="va">m</span>,</span>
<span>  terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c12hour"</span>, <span class="st">"c161sex"</span>, <span class="st">"c160age"</span>, <span class="st">"e15relat [child,sibling]"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"random"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>If the group factor has too many levels, you can also take a random
sample of all possible levels and plot the adjusted predictions for this
subsample of unit-levels. To do this, use
<code>term = "&lt;groupfactor&gt; [sample=n]"</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span><span class="op">)</span></span>
<span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span><span class="va">m</span>, terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Days"</span>, <span class="st">"Subject [sample=7]"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>You can also add the observed data points for each group using
<code>show_data = TRUE</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span>, show_data <span class="op">=</span> <span class="cn">TRUE</span>, show_ci <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
<div class="section level4">
<h4 id="prediction-and-confidence-intervals">Prediction and confidence intervals<a class="anchor" aria-label="anchor" href="#prediction-and-confidence-intervals"></a>
</h4>
<p>If unit-levels are of interest, setting <code>type = "random"</code>
is obligatory. However, sometimes it can be useful to have
<em>confidence</em> instead of prediction intervals, e.g. for <a href="introduction_comparisons_1">pairwise comparisons</a> of random
effects. Confidence instead of prediction intervals can be calculated by
explicitly setting <code>interval = "confidence"</code>, in which case
the random effects variances are ignored.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpredict.html">ggpredict</a></span><span class="op">(</span></span>
<span>  <span class="va">m</span>,</span>
<span>  terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Days"</span>, <span class="st">"Subject [sample=7]"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"confidence"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_randomeffects_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Brooks ME, Kristensen K, Benthem KJ van, Magnusson A, Berg CW,
Nielsen A, et al. glmmTMB Balances Speed and Flexibility Among Packages
for Zero-inflated Generalized Linear Mixed Modeling. The R Journal.
2017;9: 378–400.</p>
<p>Johnson PC, O’Hara RB. 2014. Extension of Nakagawa &amp; Schielzeth’s
R2GLMM to random slopes models. Methods Ecol Evol, 5: 944-946. (doi:
10.1111/2041-210X.12225)</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/strengejacke" class="external-link">Daniel Lüdecke</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
