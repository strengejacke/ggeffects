<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Technical Details: Adding own class-methods to ggeffects • ggeffects</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Technical Details: Adding own class-methods to ggeffects">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggeffects</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.18</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-introductions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Introductions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-introductions">
<li><a class="dropdown-item" href="../articles/ggeffects.html">Adjusted predictions of regression models</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_effectsatvalues.html">Adjusted predictions at specific values</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_randomeffects.html">Adjusted predictions for mixed models</a></li>
    <li><a class="dropdown-item" href="../articles/practical_robustestimation.html">(Cluster) Robust standard errors</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-interpretation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Interpretation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-interpretation">
<li><a class="dropdown-item" href="../articles/introduction_comparisons_1.html">Contrasts and pairwise comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_2.html">Slopes, floodlight and spotlight analysis</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_3.html">Contrasts and pairwise comparisons for GLM</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_4.html">Contrasts and pairwise comparisons for Zero-Inflation Models</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_5.html">Using marginaleffects or emmeans for comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_partial_residuals.html">Adding partial residuals to effects plots</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-plotting-and-printing" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Plotting and Printing</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-plotting-and-printing">
<li><a class="dropdown-item" href="../articles/introduction_plotmethod.html">Plotting adjusted predictions</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_plotcustomize.html">Customize plot appearance</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_print.html">Customize table appearance</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case Studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies">
<li><a class="dropdown-item" href="../articles/practical_glm_workflow.html">Simple workflow using logistic regression</a></li>
    <li><a class="dropdown-item" href="../articles/practical_logisticmixedmodel.html">Logistic mixed effects Model with interaction term</a></li>
    <li><a class="dropdown-item" href="../articles/practical_intersectionality.html">Intersectionality analysis using the MAIHDA framework</a></li>
    <li><a class="dropdown-item" href="../articles/practical_marginaleffects_pkg.html">Comparison of ggeffects and marginaleffects</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical-details" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical Details</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical-details">
<li><a class="dropdown-item" href="../articles/technical_get_predictions.html">Adding own class-methods to ggeffects</a></li>
    <li><a class="dropdown-item" href="../articles/technical_differencepredictemmeans.html">Difference between marginalization methods</a></li>
    <li><a class="dropdown-item" href="../articles/technical_stata.html">Different Output between Stata and ggeffects</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/strengejacke/ggeffects/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Technical Details: Adding own class-methods to ggeffects</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/strengejacke/ggeffects/blob/master/vignettes/technical_get_predictions.Rmd" class="external-link"><code>vignettes/technical_get_predictions.Rmd</code></a></small>
      <div class="d-none name"><code>technical_get_predictions.Rmd</code></div>
    </div>

    
    
<p><code><a href="../reference/get_predictions.html">get_predictions()</a></code> is the core function to return
adjusted predictions for a model, when calling <code><a href="../reference/ggpredict.html">ggpredict()</a></code>
or <code><a href="../reference/predict_response.html">predict_response()</a></code> with
<code>margin = "mean_reference"</code> (the default option for
<code>margin</code>). Basically, the input contains the model object and
a data grid that is typically used for the <code>newdata</code> argument
of the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method. <code><a href="../reference/get_predictions.html">get_predictions()</a></code> can
be used as S3-method for own classes, to add support for new models in
<strong>ggeffects</strong> and is only relevant for package
developers.</p>
<p>There are no S3-class definitions for <code><a href="../reference/ggpredict.html">ggemmeans()</a></code> or
<code><a href="../reference/ggpredict.html">ggaverage()</a></code>, because these functions simply call methods
from the <strong>emmeans</strong> or <strong>marginaleffects</strong>
packages. Hence, methods should be written for those packages, too, if a
model-object should work with <code><a href="../reference/ggpredict.html">ggemmeans()</a></code> or
<code><a href="../reference/ggpredict.html">ggaverage()</a></code>.</p>
<div class="section level2">
<h2 id="input-arguments-that-are-passed-to-get_predictions">Input: Arguments that are passed to
<code>get_predictions()</code><a class="anchor" aria-label="anchor" href="#input-arguments-that-are-passed-to-get_predictions"></a>
</h2>
<p>Adding support for <code><a href="../reference/ggpredict.html">ggpredict()</a></code> (or:
<code><a href="../reference/predict_response.html">predict_response()</a></code> with default options) is quite easy. In
order to make your model class work with <code><a href="../reference/ggpredict.html">ggpredict()</a></code>, you
need to add a <code><a href="../reference/get_predictions.html">get_predictions()</a></code> method.
<code><a href="../reference/get_predictions.html">get_predictions()</a></code> is called from
<code><a href="../reference/predict_response.html">predict_response()</a></code> and following arguments are
<em>always</em> passed to <code><a href="../reference/get_predictions.html">get_predictions()</a></code> - no matter if
the corresponding class requires all of those arguments or not:</p>
<ul>
<li>model, data_grid, terms, ci_level, model_info, type, typical, vcov,
vcov_args, condition, interval, link_inverse, bias_correction,
verbose</li>
</ul>
<p>Please refer to the documentation of <code><a href="../reference/predict_response.html">predict_response()</a></code>
for explanation of these arguments</p>
<p>It is not necessary to process all of those arguments, but they can
be used to modulate certain settings when calculating predictions. Note
that if your method does not define all mentioned arguments, these are
still passed via <code>...</code> - make sure that further methods in
your <code><a href="../reference/get_predictions.html">get_predictions()</a></code> method still work when they process
the <code>...</code>.</p>
</div>
<div class="section level2">
<h2 id="output-the-data-frame-structure">Output: the data.frame structure<a class="anchor" aria-label="anchor" href="#output-the-data-frame-structure"></a>
</h2>
<p>It is important that the function returns a data frame with a
specific structure, namely the data grid (argument
<code>data_grid</code>, that was passed to
<code><a href="../reference/get_predictions.html">get_predictions()</a></code>), including the additional columns
<code>predicted</code>, <code>conf.low</code>, and
<code>conf.high</code> (which are the results of the
<code><a href="../reference/get_predictions.html">get_predictions()</a></code> function). Note that predictions and
intervals usually should be on the response scale.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>A simple example for an own class-implementation for Gaussian-alike
models could look like this:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_predictions.own_class</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">data_grid</span>, <span class="va">ci_level</span> <span class="op">=</span> <span class="fl">0.95</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>    <span class="va">model</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">data_grid</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>    se.fit <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ci_level</span><span class="op">)</span>,</span>
<span>    <span class="va">...</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># do we have standard errors?</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ci_level</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># copy predictions</span></span>
<span>    <span class="va">data_grid</span><span class="op">$</span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">predictions</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># copy predictions</span></span>
<span>    <span class="va">data_grid</span><span class="op">$</span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="va">predictions</span><span class="op">$</span><span class="va">fit</span></span>
<span></span>
<span>    <span class="co"># calculate CI</span></span>
<span>    <span class="va">data_grid</span><span class="op">$</span><span class="va">conf.low</span> <span class="op">&lt;-</span> <span class="va">predictions</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span> <span class="op">*</span> <span class="va">predictions</span><span class="op">$</span><span class="va">se.fit</span></span>
<span>    <span class="va">data_grid</span><span class="op">$</span><span class="va">conf.high</span> <span class="op">&lt;-</span> <span class="va">predictions</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span> <span class="op">*</span> <span class="va">predictions</span><span class="op">$</span><span class="va">se.fit</span></span>
<span></span>
<span>    <span class="co"># optional: copy standard errors</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data_grid</span>, <span class="st">"std.error"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">predictions</span><span class="op">$</span><span class="va">se.fit</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">data_grid</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A simple example for an own class-implementation for
non-Gaussian-alike models could look like this (note the use of the
link-inverse function <code><a href="https://easystats.github.io/insight/reference/link_inverse.html" class="external-link">link_inverse()</a></code>, which is passed to
the <code>link_inverse</code> argument):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_predictions.own_class</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>,</span>
<span>                                      <span class="va">data_grid</span>,</span>
<span>                                      <span class="va">ci_level</span> <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>                                      <span class="va">link_inverse</span> <span class="op">=</span> <span class="fu">insight</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/insight/reference/link_inverse.html" class="external-link">link_inverse</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>,</span>
<span>                                      <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>    <span class="va">model</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">data_grid</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"link"</span>, <span class="co"># for non-Gaussian, return on link-scale</span></span>
<span>    se.fit <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ci_level</span><span class="op">)</span>,</span>
<span>    <span class="va">...</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># do we have standard errors?</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ci_level</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># copy predictions</span></span>
<span>    <span class="va">data_grid</span><span class="op">$</span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/link_inverse.html" class="external-link">link_inverse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">predictions</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># copy predictions, use link-inverse to back-transform</span></span>
<span>    <span class="va">data_grid</span><span class="op">$</span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/link_inverse.html" class="external-link">link_inverse</a></span><span class="op">(</span><span class="va">predictions</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># calculate CI</span></span>
<span>    <span class="va">data_grid</span><span class="op">$</span><span class="va">conf.low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/link_inverse.html" class="external-link">link_inverse</a></span><span class="op">(</span></span>
<span>      <span class="va">predictions</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span> <span class="op">*</span> <span class="va">predictions</span><span class="op">$</span><span class="va">se.fit</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">data_grid</span><span class="op">$</span><span class="va">conf.high</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/link_inverse.html" class="external-link">link_inverse</a></span><span class="op">(</span></span>
<span>      <span class="va">predictions</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span> <span class="op">*</span> <span class="va">predictions</span><span class="op">$</span><span class="va">se.fit</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># optional: copy standard errors</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data_grid</span>, <span class="st">"std.error"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">predictions</span><span class="op">$</span><span class="va">se.fit</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">data_grid</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/strengejacke" class="external-link">Daniel Lüdecke</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
